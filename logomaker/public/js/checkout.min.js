function setupStripe() {
    var a = StripeCheckout.configure({
        key: stripePublicKey,
        image: "img/online-freelogo-128x128.png",
        locale: "auto",
        token: function (a) {
            addWaitingOverlay(),
            doPost("/payment", {
                country: $(".top-countries-list").val(),
                stripeToken: a.id,
                paymentType: "creditCard",
                amt: $(".totalPrice:first").text(),
                currency: $(".currencyField:first").text()
            }, function (a) {
                removeWaitingOverlay(),
                200 == a.status ? (showToast("Successfull payment.", "success"), window.location = "/thank-you-for-buying-from-us") : (console.log(a), showToast("Error: " + a.msg))
            }, function (a) {
                removeWaitingOverlay(),
                console.log(a),
                showToast("Connection Error!!")
            })
        }
    });
    $("#customButton").on("click", function (b) {
        $("#editProfileForm").valid() && (a.open({
            name: "Tagbit.co",
            description: $("#checkoutList").children().length + " item(s).",
            amount: $(".totalPrice:first").val(),
            currency: $($(".currencyField")[0]).text()
        }), b.preventDefault())
    }),
    $(window).on("popstate", function () {
        a.close()
    })
}
$(function () {
    function a() {
        $("head").append($("#allFonts").children()),
        c(),
        $("#checkout-counry").select2(),
        $("#payment-type").select2().on("change", function (a) {
            var b = $("#s2id_payment-type .select2-chosen").text();
            "Credit/Debit Card" == b ? ($(".radio-wrapper").slideDown(), $("#cardDetails").show()) : ($(".radio-wrapper").slideUp(), $(".cardDetails").slideUp())
        }),
        $("#province").select2(),
        $(".tooltip1").tooltip(),
        $(".card-type").click(function () {
            var a = $("input[name=card-type]:checked").val();
            "visa" == a ? $("#billingAddr").show() : $("#billingAddr").hide()
        }),
        $("#proceedToPayment").click(function (a) {
            a.preventDefault(),
            a.stopPropagation();
            var b = function () {
                $(".checkout-tab-pane").removeClass("active"),
                $("#w1-payment").addClass("active"),
                $(".wizard-li").removeClass("active"),
                $("li.li-payment").addClass("active"),
                window.scrollTo(0, 0)
            };
            if ($("#editProfileForm").valid()) {
                var c = function () {
                    addWaitingOverlay();
                    var a = {
                        email_id: $("#emailId", $("#editProfileForm")).val(),
                        phone_num: $("#phone_num", $("#editProfileForm")).val(),
                        first_name: $("#first_name", $("#editProfileForm")).val(),
                        last_name: $("#last_name", $("#editProfileForm")).val(),
                        address_1: $("#address1", $("#editProfileForm")).val(),
                        address_2: $("#address2", $("#editProfileForm")).val(),
                        country: $("#country", $("#editProfileForm")).val(),
                        city: $("#city", $("#editProfileForm")).val(),
                        state: $("#state", $("#editProfileForm")).val(),
                        postal_code: $("#postal_code", $("#editProfileForm")).val(),
                        password: $("#current_password", $("#editProfileForm")).val(),
                        show_in_list: $("#save_addr", $("#editProfileForm")).is(":checked")
                    };
                    a.salt = getNewRandomNumber(1e3, 9999),
                    a.md5_password = MD5(a.salt + ":" + a.password),
                    delete a.password,
                    doPost("/updateCheckoutDetails", a, function (c) {
                        removeWaitingOverlay(),
                        200 == c.status ? ($(".paymentGatewayLogo").attr("src", "IN" == $(".top-countries-list").val() ? "/img/high-resolution-original.png" : "/img/paypal.jpg"), isLoggedIn() ? b() : bootbox.alert("An account is created for you with the specified email and password. You can login with the credentials.", function () {
                            signin($("#emailId").val(), $("#current_password").val(), function () {
                                doPost("/updateCheckoutDetails", a, function (a) {
                                    200 == a.status ? b() : (console.log(a), bootbox.alert("Error: " + a.msg))
                                }, function (a) {
                                    console.log(a),
                                    bootbox.alert(a)
                                })
                            })
                        })) : (console.log(c), bootbox.alert("Error: " + c.msg))
                    }, function (a) {
                        removeWaitingOverlay(),
                        console.log(a),
                        bootbox.alert("Server error: communication failure.")
                    })
                };
                $("#use_coupon").is(":checked") ? bootbox.prompt("Enter your coupon code: ", function (a) {
                    if (null != a) {
                        var b = $("#first_name").val() + " " + $("#last_name").val(),
                            d = $("#emailId").val(),
                            e = $(".totalPrice:first").val(),
                            f = $(".totalPrice:first").val(),
                            g = a,
                            h = "ORDER_ID",
                            i = $($(".currencyField")[0]).text();
                        invoiceRefiral(f, e, g, n, b, d, h, i),
                        c()
                    } else 
                        bootbox.alert("Please enter a valid cupon code")
                    
                }) : c()
            }
        }),
        $("#proceed-pay-back").on("click", function (a) {
            a.preventDefault(),
            $(".checkout-tab-pane").removeClass("active"),
            $("#w1-delivery").addClass("active"),
            $(".wizard-li").removeClass("active"),
            $("li.li-delivery").addClass("active")
        }),
        $("#proceedBack").click(function (a) {
            $(".mainContainer").show(),
            $(".details").hide(),
            $(".checkout-tab-pane").removeClass("active"),
            $("#w1-preview").addClass("active"),
            $(".wizard-li").removeClass("active"),
            $("li.li-preview").addClass("active"),
            $("body").scrollTop(1)
        }),
        $("#proceed-third-party").on("click", function (a) {
            a.preventDefault(),
            h()
        }),
        $("#procceedBtn").click(function (a) {
            if (a.preventDefault(), 0 == isLoggedIn(!1)) 
                bootbox.alert("Please login before you make a purchase.", function (a) {
                    window.location = "/login?from=checkout"
                });
             else if ($("#editProfileForm").validate({
                debug: !0,
                messages: {
                    terms: "<b>You must accept the Terms and Conditions</b>",
                    emailId: "Email ID is required.",
                    first_name: "First name is required",
                    phone_num: "Phone number is required",
                    last_name: "Last name is required",
                    address1: "Address Line 1 is required",
                    city: "City is required",
                    state: "State is required",
                    country: "Country is required",
                    postal_code: "Postal Code is required",
                    current_password: "Password is reqired",
                    confirm_password: "You must confirm the password"
                },
                showErrors: function (a, c) {
                    if (b) {
                        if (c.length > 0) {
                            var d = "<b>Pleae fix the following errors: </b><br/><br/><ul>";
                            $.each(c, function () {
                                d += "<li>" + this.message + "</li>"
                            }),
                            d += "</ul>",
                            $("#validationError").show(),
                            $("#validationError").html(d)
                        } else 
                            $("#validationError").hide();
                         b = !1
                    }
                    this.defaultShowErrors()
                },
                invalidHandler: function (a, c) {
                    b = !0
                }
            }), $(".shoppingCartItem").length > 0) {
                var b;
                $(".mainContainer").hide(),
                $(".details").show();
                var c = $("#savedAddress"),
                    d = getUser();
                c.children().remove(),
                $(".checkoutCountrySelector").val($(".top-countries-list").val()),
                void 0 != d ? doPost("/listAddresses", {}, function (a) {
                    if (200 == a.status) 
                        if (0 == a.addresses.length) 
                            $("#editProfileForm #emailId").val(d.email),
                            $("#editProfileForm #phone_num").val(d.phone_num),
                            $("#editProfileForm #first_name").val(d.first_name),
                            $("#editProfileForm #last_name").val(d.last_name),
                            $("#editProfileForm #address1").val(null == d.address ? "" : d.address.split("\n")[0]),
                            $("#editProfileForm #address2").val(null == d.address ? "" : d.address.split("\n")[1]),
                            $("#editProfileForm #country").val($(".top-countries-list").val()),
                            $("#editProfileForm #state").val(d.state),
                            $("#editProfileForm #city").val(d.city),
                            $("#editProfileForm #postal_code").val(d.postal_code),
                            $("#editProfileForm .pwd").hide(),
                            $("#editProfileForm #savedAddresses").hide();
                        
                     else {
                        for (var b = 0; b < a.addresses.length; b++) {
                            var e = a.addresses[b];
                            c.append('<option value="' + e.id + '" data-email="' + e.email_address + '" data-ph="' + e.phone_number + '" data-fname="' + e.first_name + '" data-lname="' + e.last_name + '" data-addr1="' + e.address1 + '" data-addr2="' + e.address2 + '" data-city="' + e.city + '" data-state="' + e.state + '" data-country="' + e.country + '" data-postal_code="' + e.postal_code + '">' + e.email_address + ", " + e.phone_number + ", " + e.first_name + ", " + e.last_name + ", " + e.address1 + ", " + e.address2 + ", " + e.city + ", " + e.state + ", " + e.country + ", " + e.postal_code + "</option>")
                        }
                        $("#editProfileForm #emailId").val(a.addresses[a.addresses.length - 1].email_address),
                        $("#editProfileForm #phone_num").val(a.addresses[a.addresses.length - 1].phone_number),
                        $("#editProfileForm #first_name").val(a.addresses[a.addresses.length - 1].first_name),
                        $("#editProfileForm #last_name").val(a.addresses[a.addresses.length - 1].last_name),
                        $("#editProfileForm #address1").val(a.addresses[a.addresses.length - 1].address1),
                        $("#editProfileForm #address2").val(a.addresses[a.addresses.length - 1].address2),
                        $("#editProfileForm #country").val($(".top-countries-list").val()),
                        $("#editProfileForm #state").val(a.addresses[a.addresses.length - 1].state),
                        $("#editProfileForm #city").val(a.addresses[a.addresses.length - 1].city),
                        $("#editProfileForm #postal_code").val(a.addresses[a.addresses.length - 1].postal_code),
                        $("#editProfileForm #savedAddresses").show()
                    } else 
                        bootbox.alert("Can't list saved addresses.")
                    
                }) : ($("#savedAddresses").hide(), $(".pwd").show()),
                c.select2({
                    formatResult: function (a) {
                        var b = a.element;
                        return a.id ? $(b).data("email") + " (Ph: " + $(b).data("ph") + ") <br/>" + $(b).data("fname") + " " + $(b).data("lname") + ", " + $(b).data("addr1") + ", " + $(b).data("addr2") + ", " + $(b).data("city") + ", " + $(b).data("state") + ", " + $(b).data("country") + ", PIN: " + $(b).data("postal_code") : a.text
                    },
                    escapeMarkup: function (a) {
                        return a
                    }
                }).on("select2-selecting", function (a) {
                    var b = $(a.choice.element),
                        c = $("#editProfileForm");
                    $("#editProfileForm #emailId", c).val(b.data("email")),
                    $("#editProfileForm #phone_num", c).val(b.data("ph")),
                    $("#editProfileForm #first_name", c).val(b.data("fname")),
                    $("#editProfileForm #last_name", c).val(b.data("lname")),
                    $("#editProfileForm #address1", c).val(b.data("addr1")),
                    $("#editProfileForm #address2", c).val(b.data("addr2")),
                    $("#editProfileForm #city", c).val(b.data("city")),
                    $("#editProfileForm #state", c).val(b.data("state")),
                    $(".checkoutCountrySelector", c).val($(".top-countries-list").val()),
                    $("#editProfileForm #postal_code", c).val(b.data("postal_code"))
                }),
                $(".checkoutCountrySelector").val($(".top-countries-list").val()),
                $(".price2").text($(".currencyField:first").text() + " " + $(".totalPrice:first").text()),
                $(".checkout-tab-pane").removeClass("active"),
                $("#w1-delivery").addClass("active"),
                $(".wizard-li").removeClass("active"),
                $("li.li-delivery").addClass("active")
            } else 
                bootbox.alert("No items in the checkout list. Please add some items and come back.")
            
        }),
        $("#btnDeleteAddr").click(function (a) {
            a.preventDefault()
        }),
        $(".top-countries-list").on("change.bfhselectbox", function () {
            $(".checkoutCountrySelector").val($(".top-countries-list").val()),
            d()
        }),
        $("#country").on("change.bfhselectbox", function () {
            $(".top-countries-list").val($("#country").val()),
            $(".top-countries-list").trigger("change.bfhselectbox")
        }),
        d()
    }
    function b(a, b, c, d, e) {
        var f = parseFloat(d[0]),
            g = parseFloat(d[1]),
            h = parseFloat(d[2]),
            i = parseFloat(d[3]),
            j = parseFloat(d[4]),
            k = parseFloat(d[5]),
            l = parseFloat(d[6]),
            m = parseFloat(d[7]),
            n = parseFloat(d[8]);
        a.window.init($),
        a.window.setImage("/getOtherProductImage?id=" + b, function () {
            a.window.draw("/getUserOtherProductImage?id=" + c, f, g, h, i, j, k, l, m, n)
        })
    }
    function c() {
        var a = function (a) {
                var b,
                    c;
                "string" == typeof a.item_id && 0 == a.item_id.indexOf("logo_") ? (b = "data:image/svg+xml;base64," + Base64.encode(a.url), c = a.item_id) : (b = "/getUserLogoImage?id=" + a.logo.s3_logo_url + "&random=" + Math.random(), c = a.logo.s3_logo_url);
                var e = $('<div style="display:flex; width:100%;" class="shoppingCartItems' + a.item_id + ' logoItem"><div class="col-md-6 fms-bulb-header" id="cartLogoItem' + a.item_id + '"><span class="flip-card-template" ></span></div>  <div class="col-md-4 column-spacing logo-section">  <div class="checkout-buy-text">Buy Now <span class="currencyField">...</span> <span data-type="logo" data-id=' + a.item_id + '  class="shoppingCartItem discountedMoneyField moneyField logoPrice' + a.item_id + '">...</span></div>  <div><small>compare at <strike><b><span class="currencyField">...</span> <span data-type="logo" data-id=' + a.item_id + ' class="logoPrice' + a.item_id + '">...</span></b></strike>.<br/>Save upto <b>' + flatDiscountPercentageLogo + '%</b> Today!</small></div>  <div class=""></div>  <div class="remove-link">      <a href="#" class="tooltip2 removeLogo' + a.item_id + '" data-toggle="tooltip" data-placement="bottom" data-original-title="Remove"><i class="fa fa-trash-o"></i>Remove</a>       <a href="/logo-designer/edit/' + a.item_id + '/mydesigns" data-placement="bottom" data-original-title="Edit"><i class="fa fa-pencil-square-o"></i>Edit</a>      <a href="/design-business-card-online/use/' + c + '"  class="action-header" data-placement="bottom" data-original-title="Create Card"><i class="fa fa-plus"></i>Create Card</a>  </div></div></div>');
                $("#checkoutList").append(e),
                updateJQSvgImage("#cartLogoItem" + a.item_id, b),
                $(".removeLogo" + a.item_id).click(function (b) {
                    b.preventDefault(),
                    j(a.item_id + "", "LOGO")
                }),
                $(".shoppingCartItems" + a.item_id).hide(),
                m++,
                m == l && d()
            },
            c = function (a) {
                console.log("a.product.seo_url",a)
                var c = $('<div style="display: flex;width: 100%;" class="shoppingCartItems' + a.product.id + ' productItem">  <div class="col-md-6 fms-bulb-header other-product-bulb">  <!--div class="otherProductCartItem" id="cartProductItem' + a.product.id + '"></div-->  <iframe data-url="' + a.product.image_url + '" id="cartProductItem' + a.product.id + '" name="cartProductItem' + a.product.id + '" data-id="' + a.product.id + '" data-base-url="' + a.product.base_image_url + '" data-base-params-front="' + a.product.base_params_front + '" data-front-logo-params="' + a.product.front_logo_params + '" src="/product-preview/big-preview.html" class="otherProductCartItem otherProductIframe"></iframe>  <span class="flip-card-template"></span>  </div>  <div class="col-md-4 column-spacing">  <div class="checkout-buy-text">Buy Now <span class="currencyField">...</span> <span data-type="other"  data-id=' + a.product.id + ' class="shoppingCartItem discountedMoneyField moneyField productPrice' + a.product.id + '">...</span></div>  <div><small>compare at <b><strike><span class="currencyField">...</span> <span data-type="other" data-id=' + a.product.id + ' class="productPrice' + a.product.id + '">...</span></strike></b>.<br/>Save upto <b>' + flatDiscountPercentageOther + '%</b> Today!</small></div>  <div><small>Total <b id="otherProductQty' + a.product.id + '">...</b> ' + a.product.product_name + 's</small></div><div class="remove-link"><a class="removeProduct' + a.product.id + '" href="#"><i class="fa fa-trash-o"></i> Remove</a>           <a href="/other/' + a.product.seo_url + "/edit/" + a.product.id + '/mydesigns"><i class="fa fa-pencil-square-o"></i> Edit</a>       </div></div></div></div>');
                $("#checkoutList").append(c),
                $("#cartProductItem" + a.product.id).on("load", function () {
                    window["cartProductItem" + a.product.id].window.initScalablePreview($, "/getOtherProductImage?id=" + $(this).attr("data-base-url"), "/getUserOtherProductImage?id=" + $(this).attr("data-url"), $(this).attr("data-base-params-front").split(";"), !0, 254)
                }),
                $("#cartProductItem" + a.product.id).on("load", function () {
                    b(window["cartProductItem" + a.product.id], $(this).attr("data-base-url"), $(this).attr("data-url"), $(this).attr("data-front-logo-params").split(";"), $(this).attr("data-base-params-front").split(";"))
                }),
                $(".removeProduct" + a.product.id).click(function (b) {
                    b.preventDefault(),
                    j(a.product.id + "", "OTHER")
                }),
                $(".shoppingCartItems" + a.product.id).hide(),
                m++,
                m == l && d()
            },
            cc = function (a) {
                console.log("a.product.seo_url",a)
                var c = $('<div style="display: inline-block;width: 100%;" class="shoppingCartItems' + a.product.id + ' productItem">' +
                        '  <div class="col-md-8 fms-bulb-header other-product-bulb">' +
                        '  <img  src="/getMyOtherProductImage?id='+a.product.front_image+'" class="image_stack__image" style="height: inherit !important;">'+
                        '  <span class="flip-card-template"></span>'+
                        '  </div>' +
                        '  <div class="col-md-4 column-spacing">' +
                        '  <div class="checkout-buy-text">Buy Now <span class="currencyField">...</span> <span data-type="other"  data-id='+a.product.id+' class="shoppingCartItem discountedMoneyField moneyField productPrice' + a.product.id + '">...</span></div>' +
                        '  <div><small>compare at <b><strike><span class="currencyField">...</span> <span data-type="other" data-id='+a.product.id+' class="productPrice' + a.product.id + '">...</span></strike></b>.<br/>Save upto <b>'+flatDiscountPercentageOther+'%</b> Today!</small></div>' +
                        '  <div><small>Total <b id="otherProductQty' +a.product.id+ '">...</b> ' + a.product.title + "s" + '</small></div>' + 
                        '  </div>' +
                        '       <div class="col-md-4 remove-link">' +
                        '           <a class="removeProduct' + a.product.id +'" href="#"><i class="fa fa-trash-o"></i> Remove</a>' +
                        '       </div>' +
                        '</div>' +
                        '</div>');
            
                $("#checkoutList").append(c),
                $("#cartProductItem" + a.product.id).on("load", function () {
                    window["cartProductItem" + a.product.id].window.initScalablePreview($, "/getOtherProductImage?id=" + $(this).attr("data-base-url"), "/getUserOtherProductImage?id=" + $(this).attr("data-url"), $(this).attr("data-base-params-front").split(";"), !0, 254)
                }),
                $("#cartProductItem" + a.product.id).on("load", function () {
                    b(window["cartProductItem" + a.product.id], $(this).attr("data-base-url"), $(this).attr("data-url"), $(this).attr("data-front-logo-params").split(";"), $(this).attr("data-base-params-front").split(";"))
                }),
                $(".removeProduct" + a.product.id).click(function (b) {
                    b.preventDefault(),
                    j(a.product.id + "", "OTHER")
                }),
                $(".shoppingCartItems" + a.product.id).hide(),
                m++
               // m == l && d()
            },
            e = function (a) {
                var b;
                "string" == typeof a.card.id && 0 == a.card.id.indexOf("card_") ? "string" == typeof a.card.url && (b = "data:image/svg+xml;base64," + Base64.encode(a.card.url)) : b = "/getUserCardImage?id=" + a.card.s3_front_card_url + "&random=" + Math.random();
                var c = $('<div style="display: flex;width: 100%;" class="shoppingCartItems' + a.card.id + ' cardItem">  <div class="col-md-6 fms-bulb-header">  <div id="cartCardItem' + a.card.id + '"></div>  <span class="flip-card-template"></span>  </div>  <div class="col-md-4 column-spacing">  <div class="checkout-buy-text">Buy Now <span class="currencyField">...</span> <span data-type="bc"  data-id=' + a.card.id + ' class="shoppingCartItem discountedMoneyField moneyField cardPrice' + a.card.id + '">...</span></div>  <div><small>compare at <b><strike><span class="currencyField">...</span> <span data-type="bc" data-id=' + a.card.id + ' class="cardPrice' + a.card.id + '">...</span></strike></b>.<br/>Save upto <b>' + flatDiscountPercentageCard + '%</b> Today!</small>'+
                '<div class="remove-link">' + (
                    isLoggedIn() ? '           <a href="/duplicate-card?id=' + a.card.id + '"><i class="fa fa-plus"></i> Duplicate Card</a>' : ""
                ) + '           <a class="removeCard' + a.card.id + '" href="#"><i class="fa fa-trash-o"></i> Remove</a>           <a href="/design-business-card-online/edit/' + a.card.id + '/mydesigns"><i class="fa fa-pencil-square-o"></i> Edit</a>       </div>'
                +'</div></div> <div class="col-md-4 column-spacing"> <div class="purchase-header">Purchase Details</div><div class="checkout-purchase-details">' + (
                1 == a.card.purchase_design && 1 == a.card.dont_print_card ? "" : '  <span class="order-labels">Quantity : <span class="order-list qty">' + a.card.qty + '</span></span>  <span class="order-labels">Finish : <span class="order-list finish">' + (
                    "GLOSS" == a.card.finish ? "Glossy" : "Matte"
                ) + '</span></span>  <span class="order-labels">Stock : <span class="order-list stock">' + (
                    "UltraPremium" == a.card.paper_stock ? "Superior" : "Executive"
                ) + '</span></span>  <span class="order-labels">Delivery : <span class="order-list shipping">' + (
                    "Std" == a.card.shipping_type ? " Standard Shipping" : "Express Shipping"
                ) + "</span></span>"
            ) + '  <span class="order-labels">Card Design : <span class="order-list shipping">' + (
                1 == a.card.purchase_design ? " Included" : "Not Included"
            ) + "</span></span>" + (
                1 == a.card.dont_print_card ? '  <span class="order-labels">Want Printed Cards : <span class="order-list shipping">No</span></span>' : ""
            ) + '  </div></div></div>');
                $("#checkoutList").append(c),
                a.card.design_type && "SystemDesign" != a.card.design_type ? updateJQSvgImage("#cartCardItem" + a.card.id, "/img/customCard.svg") : updateJQSvgImage("#cartCardItem" + a.card.id, b),
                $(".removeCard" + a.card.id).click(function (b) {
                    b.preventDefault(),
                    j(a.card.id + "", "BC")
                }),
                $(".shoppingCartItems" + a.card.id).hide(),
                m++,
                m == l && d()
            };
        if (1 == isLoggedIn(!0)) 
            addWaitingOverlay(),
            doPost("/listCartItems", {}, function (b) {
                if (removeWaitingOverlay(), 200 == b.status) {
                    l = b.items.length;
                    for (var d = 0; d < b.items.length; d++) 
                        n.push({
                            product_id: b.items[d].item_id,
                            quantity: "1",
                            name: "Item " + b.items[d].item_id
                        }),
                        function () {
                            var f = b.items[d].item_id;
                            "LOGO" == b.items[d].item_type ? (addWaitingOverlay(), doPost("/getUserLogoDetails", {
                                id: f
                            }, function (b) {
                                removeWaitingOverlay(),
                                200 == b.status ? (b.item_id = f, a(b)) : bootbox.alert(b.msg)
                            }, function (a) {
                                removeWaitingOverlay(),
                                console.log(a),
                                bootbox.alert("Error contacting server")
                            })) : "BC" == b.items[d].item_type ? (addWaitingOverlay(), doPost("/getUserCardDetails", {
                                id: b.items[d].item_id
                            }, function (a) {
                                removeWaitingOverlay(),
                                200 == a.status ? (a.item_id = f, e(a)) : bootbox.alert(a.msg)
                            }, function (a) {
                                removeWaitingOverlay(),
                                console.log(a),
                                bootbox.alert("Error contacting server")
                            })) : "CUSTOM" == b.items[d].item_type ? (addWaitingOverlay(), doGet("/getUserOtherCustomProductDetails", {
                                id: b.items[d].item_id,
                                from: "mydesigns"
                            }, function (a) {
                                removeWaitingOverlay(),
                                200 == a.status ? (a.item_id = f, console.log("a",a),cc(a) ) : bootbox.alert(a.msg)
                            }, function (a) {
                                removeWaitingOverlay(),
                                console.log(a),
                                bootbox.alert("Error contacting server")
                            })) : (addWaitingOverlay(), doGet("/getUserOtherProductDetails", {
                                id: b.items[d].item_id,
                                from: "mydesigns"
                            }, function (a) {
                                removeWaitingOverlay(),
                                200 == a.status ? (a.item_id = f, c(a)) : bootbox.alert(a.msg)
                            }, function (a) {
                                removeWaitingOverlay(),
                                console.log(a),
                                bootbox.alert("Error contacting server")
                            }))
                        }
                    
                    ()
                } else 
                    201 == b.status ? $("#checkoutList").append("<h5 style='padding: 20px'>No items has been added to the cart yet.</h5>") : bootbox.alert("Error: " + b.msg)
                
            }, function (a) {
                removeWaitingOverlay(),
                bootbox.alert("Error contacting server.")
            });
         else {
            var f = retrieveJson("carts");
            null != f && f.length > 0 ? (l = f.length, f.forEach(function (b, c) {
                var d = retrieveJson(b);
                if ("BC" == d.itemType) {
                    var f = retrieveJson("card_" + d.item_id),
                        g = {};
                    g.card = f,
                    g.card.id = "card_" + d.item_id,
                    e(g)
                } else {
                    var h = retrieveJson("logo_" + d.item_id);
                    h.item_id = "logo_" + d.item_id,
                    a(h)
                }
            })) : $("#checkoutList").append("<h5 style='padding: 20px'>No items has been added to the cart yet.</h5>")
        }
    }
    function d() {
        if ($(".top-countries-list").val()) {
            var a = $(".shoppingCartItem"),
                b = a.length,
                c = !1,
                d = function (a) {
                    a ? ($("#procceedBtn").hide(), $("#countryNotSupported").hide(), $("#multiCurrencies").show(), c =! 0) : (c || ($("#procceedBtn").show(), $("#multiCurrencies").hide()), b --, 0 == b && i())
                };
            $("#procceedBtn").show(),
            a.length > 0 && (k = void 0, a.each(function (a, b) {
                var c = $(b).data("id"),
                    h = $(b).data("type");
                "bc" == h ? e(c, ".cardPrice" + c, d) : "logo" == h ? g(c, ".logoPrice" + c, d) : f(c, ".productPrice" + c, d)
            })),
            "IN" == $(".top-countries-list").val() && $("#customButton").hide(),
            $("#paymentGatewayName").text("IN" == $(".top-countries-list").val() ? "PayTM" : "PayPal"),
            $(".paymentGatewayLogo").attr("src", "IN" == $(".top-countries-list").val() ? "/img/high-resolution-original.png" : "/img/paypal.jpg")
        }
    }
    function e(a, b, c) {
        addWaitingOverlay();
        var d = {
            type: "BC",
            itemId: a,
            country: $(".top-countries-list").val()
        };
        if ("string" == typeof a && 0 == a.indexOf("card_")) {
            var e = retrieveJson(a);
            d.cardObj = {},
            d.cardObj.qty = e.qty,
            d.cardObj.finish = e.finish,
            d.cardObj.paper_stock = e.paper_stock,
            d.cardObj.back_of_card = e.back_of_card,
            d.cardObj.back_side_super_premium = e.back_side_super_premium,
            d.cardObj.shipping_type = e.shipping_type,
            d.cardObj.shipping_type = e.shipping_type,
            d.cardObj.dont_print_card = e.dont_print_card,
            d.cardObj.purchase_design = e.purchase_design
        }
        doPost("/getPriceForItem", d, function (d) {
            if (removeWaitingOverlay(), $("#countryNotSupported").hide(), 200 == d.status) 
                $(b).text(Number(parseFloat(d.price).toFixed(2))),
                $(b + ".discountedMoneyField").text(discountAmt(flatDiscountPercentageCard, d.price)),
                $(".totalPriceCurrency").text(d.currency),
                $(b).siblings(".currencyField").text(d.currency);
             else if (201 == d.status) {
                $("#countryNotSupported").show();
                var e = Number(parseFloat(d.price).toFixed(2));
                $(b).text(e),
                $(b + ".discountedMoneyField").text(discountAmt(flatDiscountPercentageCard, e)),
                $(".totalPriceCurrency").text(d.currency),
                $(b).siblings(".currencyField").text(d.currency)
            } else 
                console.log(d),
                $("#proceedBack").click(),
                $("#countryNotSupported").show();
             d.currency && (void 0 == k ? k = d.currency : k != d.currency && c("Multiple currencies in a single shopping cart is not supported.")),
            $(".shoppingCartItems" + a).show(),
            c()
        }, function (a) {
            $(b).text("..."),
            removeWaitingOverlay(),
            console.log(a),
            c(),
            $("#proceedBack").click(),
            $("#countryNotSupported").show()
        })
    }
    function f(a, b, c) {
        addWaitingOverlay(),
        doPost("/getPriceForItem", {
            type: "OTHER",
            itemId: a,
            country: $(".top-countries-list").val()
        }, function (d) {
            removeWaitingOverlay(),
            $("#countryNotSupported").hide(),
            200 == d.status ? ($(b).text(Number(parseFloat(d.price).toFixed(2))), $(b + ".discountedMoneyField").text(discountAmt(flatDiscountPercentageCard, d.price)), $(".totalPriceCurrency").text(d.currency), $(b).siblings(".currencyField").text(d.currency), $("#otherProductQty" + a).text(d.qty)) : 201 == d.status ? ($("#countryNotSupported").show(), $(b).text(Number(parseFloat(d.price).toFixed(2))), $(b + ".discountedMoneyField").text(discountAmt(flatDiscountPercentageCard, d.price)), $(".totalPriceCurrency").text(d.currency), $(b).siblings(".currencyField").text(d.currency), $("#otherProductQty" + a).text(d.qty)) : ($(".otherProductQty" + a).text("0"), console.log(d), $("#proceedBack").click(), $("#countryNotSupported").show()),
            d.currency && (void 0 == k ? k = d.currency : k != d.currency && c("Multiple currencies in a single shopping cart is not supported.")),
            $(".shoppingCartItems" + a).show(),
            c()
        }, function (a) {
            $(b).text("..."),
            removeWaitingOverlay(),
            $("#proceedBack").click(),
            $("#countryNotSupported").show(),
            console.log(a),
            c()
        })
    }
    function g(a, b, c) {
        addWaitingOverlay(),
        doPost("/getPriceForItem", {
            type: "LOGO",
            itemId: a,
            country: $(".top-countries-list").val()
        }, function (d) {
            removeWaitingOverlay(),
            $("#countryNotSupported").hide(),
            200 == d.status ? ($(b).text(Number(parseFloat(d.price).toFixed(2))), $(b + ".discountedMoneyField").text(discountAmt(flatDiscountPercentageLogo, d.price)), $(".totalPriceCurrency").text(d.currency), $(b).siblings(".currencyField").text(d.currency)) : 201 == d.status ? ($("#countryNotSupported").show(), $(b).text(Number(parseFloat(d.price).toFixed(2))), $(b + ".discountedMoneyField").text(discountAmt(flatDiscountPercentageLogo, d.price)), $(".totalPriceCurrency").text(d.currency), $(b).siblings(".currencyField").text(d.currency)) : (console.log(d), $("#proceedBack").click(), $("#countryNotSupported").show()),
            d.currency && (void 0 == k ? k = d.currency : k != d.currency && c("Multiple currencies in a single shopping cart is not supported.")),
            $(".shoppingCartItems" + a).show(),
            c()
        }, function (a) {
            $(b).text("..."),
            removeWaitingOverlay(),
            $("#proceedBack").click(),
            $("#countryNotSupported").show(),
            console.log(a),
            c()
        })
    }
    function h() {
        var a = "IN" == $(".top-countries-list").val() ? "PayTM" : "Paypal";
        if ("PayTM" == a) {
            addWaitingOverlay(),
            doPost("/payment", {
                country: $(".top-countries-list").val(),
                paymentType: "paytm",
                amt: $(".totalPrice:first").text(),
                currency: $(".currencyField:first").text()
            }, function (a) {
                if (200 == a.status) {
                    var callbackUrl = 'https://www.tagbit.co/paytm';
                    var b = $("<form />", {
                        action: a.url,
                        method: "POST"
                    });
                    b.append($('<input name="REQUEST_TYPE" value="' + a.data.REQUEST_TYPE + '"/>')),
                    b.append($('<input name="MID" value="' + a.data.MID + '"/>')),
                    b.append($('<input name="ORDER_ID" value="' + a.data.ORDER_ID + '"/>')),
                    b.append($('<input name="CUST_ID" value="' + a.data.CUST_ID + '"/>')),
                    b.append($('<input name="TXN_AMOUNT" value="' + a.data.TXN_AMOUNT + '"/>')),
                    b.append($('<input name="CHANNEL_ID" value="' + a.data.CHANNEL_ID + '"/>')),
                    b.append($('<input name="INDUSTRY_TYPE_ID" value="' + a.data.INDUSTRY_TYPE_ID + '"/>')),
                    b.append($('<input name="WEBSITE" value="' + a.data.WEBSITE + '"/>')),
                    b.append($('<input name="CALLBACK_URL" value="' + callbackUrl + '"/>')),
                    b.append($('<input name="CHECKSUMHASH" value="' + a.data.CHECKSUMHASH + '"/>')),
                    b.append($('<input type="submit" value="Submit" />')),
                    b.hide().appendTo("body"),
                    b.submit()
                } else 
                    500 == a.status && (removeWaitingOverlay(), bootbox.alert(a.msg))
                
            }, function (a) {
                removeWaitingOverlay(),
                bootbox.alert("Server Error: Communication Failure")
            });}
         else {
            addWaitingOverlay();
            var b = $("<form />", {
                action: "/payment",
                method: "POST"
            });
            b.append($('<input name="amt" value="' + $(".totalPrice:first").text() + '"/>')),
            b.append($('<input name="currency" value="' + $(".currencyField:first").text() + '"/>')),
            b.append($('<input name="country" value="' + $(".top-countries-list").val() + '"/>')),
            b.append($('<input name="paymentType" value="paypal"/>')),
            b.hide().appendTo("body"),
            b.submit()
        }
    }
    function i() {
        for (var a = 0, b = $(".shoppingCartItem.discountedMoneyField"), c = 0; c < b.length; c++) 
            a += parseFloat($(b[c]).text());
        
        $(".totalPrice").text(Number(a).toFixed(2))
    }
    function j(a, b) {
        bootbox.confirm("Are you sure to delete this item?", function (c) {
            if (1 == c) {
                var d = function () {
                    "LOGO" == b ? $(".shoppingCartItems" + a + ".logoItem").remove() : "BC" == b ? $(".shoppingCartItems" + a + ".cardItem").remove() : $(".shoppingCartItems" + a + ".productItem").remove(),
                    $(".shoppingCartItem").length < 1 && $("#checkoutList").append("<h5 style='padding: 20px'>No items has been added to the cart yet.</h5>"),
                    $(".cart-order").text($(".shoppingCartItem").length),
                    i();
                    for (var c = 0; c < n.length; c++) 
                        if (n[c].product_id == a) {
                            n.splice(c, 1);
                            break
                        }
                    
                };
                a.indexOf("logo_") >= 0 || a.indexOf("card_") >= 0 ? (removeItemLocallyFromShoppingCart(a), d()) : doPost("/removeItem", {
                    item_id: a,
                    type: b
                }, function (a) {
                    200 == a.status ? d() : 201 == a.status ? (console.log(a), d()) : (console.log(a), bootbox.alert("Error: " + a.msg))
                })
            }
        })
    }
    var k,
        l = 0,
        m = 0,
        n = [];
    $("#checkoutList").hover(function () {
        $(this).find(".flip-card-template").show()
    }, function () {
        $(this).find(".flip-card-template").hide()
    }),
    a()
});
