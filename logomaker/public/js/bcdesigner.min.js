$(function(){function a(){if(!location.hash&&O&&(O=!1),!O)if(null==history.state){var b=window.location.pathname.split("/").splice(2).join("/");pushState(b,"design-business-card-online/"+b),a()}else{var c=function(a){1==$(".cards-list").children().length?k(function(b){K||(addWaitingOverlay(),K=!0,doPost("/listCards",{},function(c){if(K=!1,200==c.status)for(var d=0;d<c.cards.length;d++){var e=null==c.cards[d].s3_back_card_url?null:"'/getCardImage?id="+c.cards[d].s3_back_card_url+"'",f=$('<li class="col-md-3 cards-li"><div class="cardPreview" id="cardPrev'+c.cards[d].id+'" data-front-url="'+c.cards[d].s3_front_card_url+'" data-back-url="'+e+'" data-id="'+c.cards[d].id+'" data-url="'+formatUrl(c.cards[d].url,c.cards[d].id)+'" data-seo-title="'+c.cards[d].seo_title+'" data-seo-description="'+c.cards[d].seo_description+'" data-seo-keyword="'+c.cards[d].seo_keyword+'"></div></li>');$(".cards-list").append(f),updateCardImage("#cardPrev"+c.cards[d].id,"/getCardImage?id="+c.cards[d].s3_front_card_url,b),$("#cardPrev"+c.cards[d].id).click(function(a){if(a.preventDefault(),$(".wiz-one").html("<a href='/design-business-card-online' class='text-center' aria-expanded='false'><span class='badge hidden-xs'>1</span>Choose template</a>"),$("#svgedit").is(":visible"))if(window.location.pathname.split("/")[2]==$(this).attr("data-url"))showToast("Click reset button in editor to reset the card!");else{var b=$(this).attr("data-url");bootbox.confirm("The current modifications will be <b>erased</b>.<br/>Do you want to continue?",function(a){1==a&&x(b)})}else x($(this).attr("data-url"))})}else 201==c.status?bootbox.alert("No cards available"):bootbox.alert("Error: "+c.msg);a?a():$.noop(),removeWaitingOverlay()},function(b){K=!1,a?a():$.noop(),removeWaitingOverlay(),console.log(b),bootbox.alert("Server Error.")}))}):a?a():$.noop()},f=history.state.name.split("/");if("go-back"==f[1])history.back();else if(""==f[0])$(".panel-two").hide(),$("html, body").animate({scrollTop:0},1e3),$(".panel-four").hide(),$(".wizard-steps li").removeClass("active"),$(".wiz-one").addClass("active"),c();else{var g=function(a,b){addWaitingOverlay(),doPost("/getCardDetails",{id:a},function(c){if(removeWaitingOverlay(),200==c.status){var d=c.card.s3_back_card_url;d=null!=d&&"null"!=d?"/getCardImage?id="+d+"&type="+encodeURIComponent("text/plain"):"/getCardImage?id=backCardPreview.svg&type="+encodeURIComponent("text/plain"),e(f,"/getCardImage?id="+c.card.s3_front_card_url+"&type="+encodeURIComponent("text/plain"),d,a,function(){b?b():$.noop()})}else bootbox.alert(c.msg)},function(a){removeWaitingOverlay(),console.log(a),bootbox.alert("string"==typeof a?a:"Server Error.")})},h=function(a){"quantity"==f[1]&&"upload-card-design"!=f[0]&&window.editorFrame.saveAction(!0,function(a){$("#bCardPreview").attr("src",a)}),$("#bfhCountryBcard").val($(".top-countries-list").val()),$(".panel-three").slideDown(),$(".wizard-steps li").removeClass("active"),"delivery"==f[1]?$(".wiz-four").addClass("active"):$(".wiz-three").addClass("active"),$("#accordionThree").slideDown(),$("#accordionThree").addClass("in"),$(".create-card-main").css("min-height","1500px"),d(),m(),$(".contents").hide(),$("#quantity").hide(),$("#finish").hide(),$("#stock").hide(),$("#delivery").hide(),$("#back-of-card").hide(),$(".panel-body .tabs .nav li").removeClass("active"),$(".panel-body .tabs .nav li.li-"+f[1]).addClass("active"),y(f),$("html, body").animate({scrollTop:$(".panel-three").offset().top-50},1e3).promise().then(function(){a?a():$.noop()}),$("#"+f[1]).show()};if("use"==f[0])if("any"!=f[1]&&(G=f[1]),f[2]&&"any"!=f[2]){$("[data-id="+f[2]+"]");x(f[2])}else x("");else c(function(){if("edit"==f[0])i(f[1],f[2]);else{var a=$("[data-url="+f[0]+"]");switch(a.attr("data-id")&&(a.attr("data-seo-keyword")&&$("meta[name=keywords]").attr("content",a.attr("data-seo-keyword")),a.attr("data-seo-description")&&$("meta[name=description]").attr("content",a.attr("data-seo-description")),a.attr("data-seo-title")&&$("title").text(a.attr("data-seo-title"))),f[1]||$(".panel-three").hide(),f[1]){case"finish":case"stock":case"back-of-card":case"delivery":case"quantity":"upload-card-design"==f[0]||window.editorFrame&&window.editorFrame.saveAction?("upload-card-design"==f[0]?(I||(I={}),I.purchase_design=!1,I.dont_print_card=!1,$("[name=optionsPurchaseCardDesign]").parent().parent().parent().hide(),$(".goto-edit-card").hide(),$(".panel-four").is(":visible")||$(".panel-four").show()):($(".goto-edit-card").show(),$("[name=optionsPurchaseCardDesign]").parent().parent().parent().show()),h()):g(a.attr("data-id"),h),"quantity"==f[1]&&(I?("Custom"==I.back_of_card?$("[name=optionsBackOfCard][value=Custom]").prop("checked",!0):($("[name=optionsBackOfCard][value=Blank]").prop("checked",!0),I.back_of_card="Blank"),I.qty>1e3?($("#moreQtysRadio").prop("checked",!0),$("#more-quantity").val(I.qty)):I.qty?$("[name=optionsCount][value="+I.qty+"]").prop("checked",!0):($("[name=optionsCount][value='500']").prop("checked",!0),I.qty=500),"GLOSS"==I.finish?$("[name=optionsFinish][value=GLOSS]").prop("checked",!0):($("[name=optionsFinish][value=MATT]").prop("checked",!0),I.finish="MATT"),"UltraPremium"==I.paper_stock?$("[name=optionsPaper][value=UltraPremium]").prop("checked",!0):($("[name=optionsPaper][value=Premium]").prop("checked",!0),I.paper_stock="Premium"),"Exp"==I.shipping_type?$("[name=optionsShipping][value=Exp]").prop("checked",!0):($("[name=optionsShipping][value=Std]").prop("checked",!0),I.shipping_type="Std"),1==I.purchase_design?$("[name=optionsPurchaseCardDesign]").prop("checked",!0):($("[name=optionsPurchaseCardDesign]").prop("checked",!1),I.purchase_design=!1),1==I.dont_print_card?$("[name=optionsDontWantPrintedCard]").prop("checked",!0):($("[name=optionsDontWantPrintedCard]").prop("checked",!1),I.dont_print_card=!1)):($("[name=optionsBackOfCard][value=Blank]").prop("checked",!0),$("[name=optionsCount][value='500']").prop("checked",!0),$("[name=optionsFinish][value=MATT]").prop("checked",!0),$("[name=optionsPaper][value=Premium]").prop("checked",!0),$("[name=optionsShipping][value=Std]").prop("checked",!0),$("[name=optionsPurchaseCardDesign]").prop("checked",!1),$("[name=optionsDontWantPrintedCard]").prop("checked",!1),I={},I.shipping_type="Std",I.paper_stock="Premium",I.finish="MATT",I.qty=500,I.back_of_card="Blank",I.purchase_design=!1,I.dont_print_card=!1),"purchase"==F&&($("[name=optionsBackOfCard][value=Blank]").attr("disabled",!0),$("[name=optionsBackOfCard][value=Custom]").attr("disabled",!0),$("#moreQtysRadio").attr("disabled",!0),$("#more-quantity").attr("disabled",!0),$("[name=optionsCount]").attr("disabled",!0),$("[name=optionsFinish][value=GLOSS]").attr("disabled",!0),$("[name=optionsFinish][value=MATT]").attr("disabled",!0),$("[name=optionsPaper][value=UltraPremium]").attr("disabled",!0),$("[name=optionsPaper][value=Premium]").attr("disabled",!0),$("[name=optionsShipping][value=Std]").attr("disabled",!0),$("[name=optionsShipping][value=Exp]").attr("disabled",!0),$("[name=optionsPurchaseCardDesign]").attr("disabled",!0),$("[name=optionsDontWantPrintedCard]").attr("disabled",!0))),1==I.dont_print_card?($("#noCardPrintOut").removeClass("hidden"),$("[name=optionsDontWantPrintedCard]").change()):$("[name=optionsPurchaseCardDesign]").change();break;case"save-card":l("upload-card-design"==f[0]);break;default:"upload-card-design"==f[0]?$(".panel-four").is(":visible")||(A=void 0,B=void 0,$(".panel-four").slideDown(),$(".panel-two").hide(),$("html, body").animate({scrollTop:$(".panel-four").offset().top-100},1e3),$(".wiz-two").html("   <a href='"+window.location+"' class='text-center' aria-expanded='false'><span class='badge hidden-xs'>2</span>Upload Custom Card</a>"),$(".wizard-steps .wiz-two a").css("cursor","pointer"),$(".wizard-steps li").removeClass("active"),$(".wiz-two").addClass("active"),"edit"==f[1]?($(".downloadFrontCardFile").show(),$(".downloadFrontCardFile").attr("href",I.s3_front_card_url),I.s3_back_card_url?($(".downloadBackCardFile").show(),$(".removeBackCardFile").show(),$(".downloadBackCardFile").attr("href",I.s3_back_card_url)):($(".downloadBackCardFile").hide(),$(".removeBackCardFile").hide())):($(".downloadFrontCardFile").hide(),$(".downloadBackCardFile").hide(),$(".removeBackCardFile").hide())):($(".wiz-two").html("   <a href='"+window.location+"' class='text-center' aria-expanded='false'><span class='badge hidden-xs'>2</span>Design Business Card</a>"),"edit"!=f[3]&&("edit"==f[1]?e(f,I.s3_front_card_url,I.s3_back_card_url,C,function(){}):g(a.attr("data-id"))))}}})}}}function b(){$("head").append($("#allFonts").html()),$("#footer").addClass("create-card-footer");$(window).height();if($(window).scroll(function(){$(".create-card-footer").show()}),$("#savedLogosList").select2({formatResult:f,formatSelection:g,escapeMarkup:function(a){return a}}),$("#uploadDesignLink").click(function(){x("upload-card-design")}),$("#savedLogosList").on("select2-close",function(a){a.preventDefault();var b=function(a){L?window.editorFrameBack.loadCard(void 0,a,!0):window.editorFrame.loadCard(void 0,a,!0)},c=$(a.target).find(":selected").data("src");if(c){if(c.indexOf("logo_")>=0){var d=retrieveJson(c);c=d.url}c.indexOf("/getUserLogoImage")>=0?$.get(c,{},function(a){b(a)},"text"):b(c)}}),isLoggedIn())doPost("/listUserLogos",{},function(a){if(200==a.status)for(var b=0;b<a.logos.length;b++){var c=a.logos[b],d=$('<option value="'+b+'" data-src="/getUserLogoImage?id='+c.s3_logo_url+"&type="+encodeURIComponent("text/plain")+'">'+c.company_name+"</option>");$("#savedLogosList").append(d)}});else{var b=retrieveJson("logos");if(null!=b)for(var e=0;e<b.length;e++){var h=retrieveJson(b[e]),i=$('<option value="'+e+'" data-src="'+b[e]+'">'+h.company_name+"</option>");$("#savedLogosList").append(i)}}$("#accordion .panel-heading").on("click",function(){$("#accordion .panel-heading").find(".panel-title a i.fa-caret-right").show(),$("#accordion .panel-heading").find(".panel-title a i.fa-caret-down").hide(),$("#accordion .panel-heading").next().hasClass("in")?($(this).find(".panel-title a i.fa-caret-right").hide(),$(this).find(".panel-title a i.fa-caret-down").show()):($(this).find(".panel-title a i.fa-caret-right").show(),$(this).find(".panel-title a i.fa-caret-down").hide())}),$(".add-new-line").on("click",function(a){a.preventDefault(),q()}),$(".displayFront").click(function(a){M=!1,a.preventDefault(),t()}),$(".displayBack").click(function(a){s(),a.preventDefault()}),$(".goto-edit-card").click(function(a){M=!1,a.preventDefault(),v()}),$("#back-to-card-lists").click(function(a){x("")}),$(".removeBackCardFile").click(function(a){a.preventDefault(),bootbox.confirm("Are you sure?",function(a){a&&(delete I.back_of_card,delete I.s3_back_card_url,A=void 0,$(".downloadBackCardFile").hide(),$(".removeBackCardFile").hide(),$("#customBackDesignUploader").val(void 0))})}),$("#next-to-card-params").click(function(a){D?I.s3_back_card_url?c():bootbox.confirm("Do you want to continue without uploading the back of card?",function(a){a&&c()}):B?A?(I.back_of_card=I.back_of_card||"Custom",c()):bootbox.confirm("Do you want to continue without uploading the back of card?",function(a){a&&c()}):bootbox.alert("Please upload file for atleast front of the card!")}),$("#customFrontDesignUploader").change(function(){z.call(this,function(a,b){B={content:a,type:b}})}),$("#customBackDesignUploader").change(function(){z.call(this,function(a,b){$(".removeBackCardFile").show(),A={content:a,type:b}})}),$("#fileUpload").change(function(){var a=this.files,b=a[0];if(b.type.match("image")){var c=new FileReader;c.addEventListener("load",function(a){var b=a.target;L?window.editorFrameBack.loadCard(void 0,b.result,!1):window.editorFrame.loadCard(void 0,b.result,!1)}),c.readAsDataURL(b)}else bootbox.alert("Please select an image")}),$("#cardName").keyup(function(){window.editorFrame&&void 0!=window.editorFrame.setCardTitle&&window.editorFrame.setCardName($("#cardName").val()),window.editorFrameBack&&void 0!=window.editorFrameBack.setCardTitle&&window.editorFrameBack.setCardName($("#cardName").val())}),$("#cardTitle").keyup(function(){window.editorFrame&&void 0!=window.editorFrame.setCardTitle&&window.editorFrame.setCardTitle($("#cardTitle").val()),window.editorFrameBack&&window.editorFrameBack.setCardTitle&&window.editorFrameBack.setCardTitle($("#cardTitle").val())}),$("#cardWebSite").keyup(function(){window.editorFrame&&void 0!=window.editorFrame.setCardTitle&&window.editorFrame.setCardWebSite($("#cardWebSite").val()),window.editorFrameBack&&void 0!=window.editorFrameBack.setCardTitle&&window.editorFrameBack.setCardWebSite($("#cardWebSite").val())}),$("#cardEmail").keyup(function(){window.editorFrame&&void 0!=window.editorFrame.setCardTitle&&window.editorFrame.setCardEmail($("#cardEmail").val()),window.editorFrameBack&&void 0!=window.editorFrameBack.setCardTitle&&window.editorFrameBack.setCardEmail($("#cardEmail").val())}),$("#cardPhone").keyup(function(){window.editorFrame&&void 0!=window.editorFrame.setCardTitle&&window.editorFrame.setCardPhone($("#cardPhone").val()),window.editorFrameBack&&void 0!=window.editorFrameBack.setCardTitle&&window.editorFrameBack.setCardPhone($("#cardPhone").val())}),$("#cardAL1").keyup(function(){window.editorFrame&&void 0!=window.editorFrame.setCardTitle&&window.editorFrame.setCardAL1($("#cardAL1").val()),window.editorFrameBack&&void 0!=window.editorFrameBack.setCardTitle&&window.editorFrameBack.setCardAL1($("#cardAL1").val())}),$("#cardAL2").keyup(function(){window.editorFrame&&void 0!=window.editorFrame.setCardTitle&&window.editorFrame.setCardAL2($("#cardAL2").val()),window.editorFrameBack&&void 0!=window.editorFrameBack.setCardTitle&&window.editorFrameBack.setCardAL2($("#cardAL2").val())}),$(".card-save").click(function(a){a.preventDefault(),"Custom"!=I.back_of_card?bootbox.confirm("Do you want to continue without editing the back of card?",function(a){a&&c()}):c()}),$(".wiz-two").click(function(a){$(".panel-three").hide()}),$("#footer").addClass("create-card-footer"),$(".cards-list .cards-li").hover(function(){$(this).addClass("active")},function(){$(this).removeClass("active")}),$(".card-back").on("click",function(){$(".wizard-steps li").removeClass("active"),$(".wiz-one").addClass("active"),$("#accordionOne").slideDown(),$("html, body").animate({scrollTop:$("#accordionOne").prev(".panel-heading").offset().top-100},1e3).promise().done(function(){x("")})}),$("#more-quantity").select2(),$(this).next().hasClass("in")?($(this).find(".panel-title a i.fa-caret-right").hide(),$(this).find(".panel-title a i.fa-caret-down").show()):($(this).find(".panel-title a i.fa-caret-right").show(),$(this).find(".panel-title a i.fa-caret-down").hide()),$(document).on("cardSavedFromLogin",function(a){D==a.localId&&(D=a.id)}),$(".logo-card").hover(function(){$(this).find(".flip-card-template-new").show()},function(){$(this).find(".flip-card-template-new").hide()}),$(".top-countries-list").on("change.bfhselectbox",function(a){a.preventDefault(),$("#bfhCountryBcard").val($(".top-countries-list").val()),$("#bfhCountryBcard").trigger("change.bfhselectbox")}),d(),a(),addPopState(a)}function c(){$(".wiz-two").html("   <a href='"+window.location+"' class='text-center' aria-expanded='false'><span class='badge hidden-xs'>2</span>Design Business Card</a>"),$(".wizard-steps .wiz-two a").css("cursor","pointer");var a=window.location.pathname.split("/").splice(2);a[1]="quantity",x(a.join("/"))}function d(){$("#bfhCountryBcard").unbind("change.bfhselectbox").on("change.bfhselectbox",function(){E!=$(this).val()&&(addWaitingOverlay(),E=$(this).val(),doPost("/getPricingDetails",{type:"BC",country:$(this).val()},function(a){removeWaitingOverlay(),200==a.status||201==a.status?(H=a,n()):bootbox.alert("Error: "+a.msg)},function(a){removeWaitingOverlay(),bootbox.alert("Error contacting server."),console.log(a)}))})}function e(a,b,c,d,e){C=d,null!=c&&void 0!=c||(c="/img/blank-card.svg"),r(function(){var f=getUser(),g=function(){void 0!=f&&($("#cardName").val()||null!=f.first_name&&(null!=f.last_name?$("#cardName").val(f.first_name+f.last_name):$("#cardName").val(f.first_name)),$("#cardAL1").val($("#cardAL1").val()?$("#cardAL1").val():null==f.address?"":f.address.replace("\n",", ")),$("#cardAL2").val($("#cardAL2").val()?$("#cardAL2").val():f.postal_code),$("#cardPhone").val($("#cardPhone").val()?$("#cardPhone").val():f.phone_num),$("#cardEmail").val($("#cardEmail").val()?$("#cardEmail").val():f.email))};j(function(){h(a,window.editorFrame,b,d,function(a,b){N.executeKeyUps()},!1),g()},function(){null!=c&&"null"!=c&&(h(a,window.editorFrameBack,c,d,function(a,b){N.executeKeyUps()},!0),g())},e)})}function f(a){var b=function(a,b){var c=function(d){setTimeout(function(){$(a).length>0?updateJQSvgImage(a,b):c(d+100)},d)};c(0)},c=a.element;if(!a.id)return a.text;var d,e=$(c).data("src");return e.indexOf("logo_")>=0?b("#cmbLogoPreview"+a.id,"data:image/svg+xml;base64,"+Base64.encode(retrieveJson(e).url)):J[e]?b("#cmbLogoPreview"+a.id,J[e]):b("#cmbLogoPreview"+a.id,e),d='<div id="cmbLogoPreview'+a.id+'" style="height: 100px"></div><span style="display: block;text-align: center;">'+a.text+"</span>"}function g(a){a.element;return a.id?a.text:a.text}function h(a,b,c,d,e,f){b.setParent(N),b.initCommon("BC");var g=function(){f&&$("#svgedit").css("visibility","visible"),e?e(c,d):$.noop()};"edit"==a[1]?(addWaitingOverlay(),b.loadCard(c,void 0,void 0,function(){b.resetImage(),removeWaitingOverlay(),g()})):(addWaitingOverlay(),k(function(a){b.loadCard(c,a,!0,function(){g(),removeWaitingOverlay()})}))}function i(a,b){D=a,F=b;var c=function(a,b){$("#cardTitle").val(a.first_name),$("#cardName").val(a.last_name),$("#cardAL1").val(a.address_line_1),$("#cardAL2").val(a.address_line_2),$("#cardPhone").val(a.phone_no),$("#cardEmail").val(a.email),$("#cardWebSite").val(a.website),C=a.base_card_id||a.base_item_id,I=a;var c=a.url_back||a.s3_back_card_url;a.id.toString().indexOf("card_")>-1?I.s3_front_card_url=a.url:(c&&(c="/getUserCardImage?id="+c+"&random="+Math.random()),I.s3_front_card_url="/getUserCardImage?id="+(b?a.url:a.s3_front_card_url)+"&random="+Math.random()),I.s3_back_card_url=c,changeState("/go-back","/go-back"),x("SystemDesign"==I.design_type?formatUrl(a.base_card_url,C)+"/edit":"upload-card-design/edit")};if(0==a.toString().indexOf("card_")){var d=retrieveJson(a);d.id=a,doPost("/getCardDetails",{id:d.base_item_id},function(a){200==a.status?(d.base_card_url=a.card.url,c(d,!1)):(console.log(a),bootbox.alert("Can't get base logo: "+a.msg))},function(a){removeWaitingOverlay(),console.log(a),bootbox.alert("string"==typeof a?a:"Server Error.")})}else{addWaitingOverlay();var e,f="purchase"==F;e=1==f?"/getPurchasedItemDetails":"/getUserCardDetails",doPost(e,{id:a},function(a){removeWaitingOverlay(),200==a.status?c(a.card,f):bootbox.alert(a.msg)},function(a){removeWaitingOverlay(),console.log(a),bootbox.alert("string"==typeof a?a:"Server Error.")})}}function j(a,b,c){addWaitingOverlay(),$("#svgedit").remove(),$("#svgedit_back").remove();var d='<iframe src="/svgedit/bceditor_frame.html?v='+version+'" name="editorFrame" style="margin: 0px; width: 100%; height: 100%; border: none; min-height: 200px; position: absolute; top: 0px; left: 0px" id="svgedit"></iframe>',e='<iframe src="/svgedit/bceditor_frame.html?v='+version+'" name="editorFrameBack" style="margin: 0px; width: 100%; height: 100%; border: none; min-height: 200px; position: absolute; top: 0px; left: 0px" id="svgedit_back"></iframe>';$(".visiting-cards-temp").append(d),$(".visiting-cards-temp").append(e),removeWaitingOverlay();var f=0,g=function(){f++,2==f&&void 0!=c&&c()};$("#svgedit").load(function(){var b=function(){removeWaitingOverlay(),a(),g(),t(!1)};addWaitingOverlay();var c=function(){window.editorFrame?window.editorFrame.svgedit.browser.isGecko()||window.editorFrame.svgedit.browser.isIE()?setTimeout(b,2048):b():setTimeout(c,1024)};c()}),$("#svgedit_back").load(function(){var a=function(){removeWaitingOverlay(),b(),g()};addWaitingOverlay();var c=function(){window.editorFrameBack?window.editorFrameBack.svgedit.browser.isGecko()||window.editorFrameBack.svgedit.browser.isIE()?setTimeout(a,2048):a():setTimeout(c,1024)};c()})}function k(a){if(G)a(G);else if(0==isLoggedIn()){var b=retrieveJson("logos");null!=b&&(G=b[b.length-1]),a(G)}else doPost("/getLastLogo",{},function(b){200==b.status?G=b.url:201==b.status||(console.log(b),bootbox.alert("Error: "+b.msg)),a(G)},function(b){a(null),console.log(b),bootbox.alert("Server Error: Communication failure.")})}function l(a){var b=$("input[type=radio][name=optionsCount]:checked").val();"More"==b&&(b=$("#more-quantity").val());var c=null,d=$("input[type=radio][name=optionsFinish]:checked").val(),e=$("input[type=radio][name=optionsBackOfCard]:checked").val(),f=$("input[type=radio][name=optionsPaper]:checked").val(),g=$("input[type=radio][name=optionsShipping]:checked").val(),h=$("[name=optionsPurchaseCardDesign]").is(":checked"),i=$("[name=optionsDontWantPrintedCard]").is(":checked");a||(c="Blank"==e&&0==M?"<svg width='255.118' height='141.732' xmlns='http://www.w3.org/2000/svg' xmlns:svg='http://www.w3.org/2000/svg' xmlns:html='http://www.w3.org/1999/xhtml' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 255.118 141.732'><metadata id='metadata3300'>image/svg+xml</metadata></svg>":window.editorFrameBack.getSvgString());var j={design_type:a,first_name:$("#cardTitle").val(),last_name:$("#cardName").val(),base_item_id:C,address_line_1:$("#cardAL1").val(),address_line_2:$("#cardAL2").val(),phone_no:$("#cardPhone").val(),email:$("#cardEmail").val(),website:$("#cardWebSite").val(),qty:b,finish:d,paper_stock:f,back_of_card:e,back_side_super_premium:$("#backSidePremium").is(":checked"),shipping_type:g,purchase_design:h,dont_print_card:i};a?(j.url=B,j.url_back=A):(j.url=window.editorFrame.getSvgString(),j.url_back=c);var k=function(b,c){D=b,1!=c?addCardToShoppingCart(D,function(){a||(window.editorFrame.ignoreSaveWarning(),window.editorFrameBack.ignoreSaveWarning()),window.location="/design-business-card-online/checkout"}):bootbox.alert("Your modification to this purchased item is finished.",function(a){window.location="/my-designs"})};if(1==isLoggedIn(!0)){var l,m="purchase"==F;D?(j.id=D,l=0==m?"/updateUserCard":"/updatePurchasedItem"):l="/addUserCard",addWaitingOverlay(!0),doPost(l,j,function(a){removeWaitingOverlay(),200==a.status?k(a.insertId||D,m):bootbox.alert(a.msg)},function(a){removeWaitingOverlay(),console.log(a),bootbox.alert("string"==typeof a?a:"Server Error.")})}else{var n,o;D?(n=D,o=n):(n=(new Date).getTime(),o="card_"+n),saveItemLocally("cards",o,j),k(n)}}function m(){for(var a=$(".top-countries-list").val(),b=$("#bfhCountryBcard a"),c=0;c<b.length;c++)if($(b[c]).data("option")==a){$(b[c]).click();break}}function n(){if(H&&H.pricing){var a=$("input[type=radio][name=optionsCount]:checked").val();"More"==a&&(a=$("#more-quantity").val());var b=$("input[type=radio][name=optionsFinish]:checked").val(),c=$("input[type=radio][name=optionsBackOfCard]:checked").val(),d=$("input[type=radio][name=optionsPaper]:checked").val(),e=$("input[type=radio][name=optionsShipping]:checked").val(),f=$("input[type=radio][name=optionsBackOfCard]:checked").val();$(".order-list").text(a),$("#cardFinishLabel").text("GLOSS"==b?"Glossy Paper":"Matte Paper"),$("#backOfCardLabel").text("Blank"==f?"Blank":"Custom"),$(".stock-list").text("UltraPremium"==d?"Superior":"Executive"),$(".back-card").text(c),$(".delivery").text("Exp"==e?"Express":"Standard");var g=0,h=$("[name=optionsPurchaseCardDesign]").is(":checked"),i=$("[name=optionsDontWantPrintedCard]").is(":checked");h&&i?g=H.pricing[0].card_design:(h&&H.pricing.length>0&&(g+=H.pricing[0].card_design),H.pricing.forEach(function(f,h){f.finish==b&&f.qty==a&&(g+="UltraPremium"==d?f.super_premium:f.premium,g+="Custom"==c?f.back_side:"Appointment"==c?f.back_side:0,1==$("#backSidePremium").is(":checked")&&(g+=f.back_side_super_premium),g+="Exp"==e?f.exp_shipping:f.std_shipping)})),$(".buss-grand-total").text(p(g)),$(".buss-discount-total").text(p(discountAmt(flatDiscountPercentageCard,g))),o(H)}}function o(a){var b=$("input[type='radio'][name='optionsFinish']:checked").val(),c=$("input[type='radio'][name='optionsPaper']:checked").val(),d=$("input[type='radio'][name='optionsCount']:checked").val();d?"More"==d&&(d=$("#more-quantity").val()):d=500;var e=0,f=!1;a.pricing.forEach(function(a,g){if(a.finish==b)switch(a.qty){case 100:"UltraPremium"==c?(e=a.super_premium,$("#priceFor100").text(p(a.super_premium)),$("#discountPriceFor100").text(p(discountAmt(flatDiscountPercentageCard,e)))):(e=a.premium,$("#priceFor100").text(p(a.premium)),$("#discountPriceFor100").text(p(discountAmt(flatDiscountPercentageCard,e))));break;case 250:"UltraPremium"==c?(e=a.super_premium,$("#priceFor250").text(p(a.super_premium)),$("#discountPriceFor250").text(p(discountAmt(flatDiscountPercentageCard,e)))):(e=a.premium,$("#priceFor250").text(p(a.premium)),$("#discountPriceFor250").text(p(discountAmt(flatDiscountPercentageCard,e))));break;case 500:"UltraPremium"==c?(e=a.super_premium,$("#priceFor500").text(p(a.super_premium)),$("#discountPriceFor500").text(p(discountAmt(flatDiscountPercentageCard,e)))):(e=a.premium,$("#priceFor500").text(p(a.premium)),$("#discountPriceFor500").text(p(discountAmt(flatDiscountPercentageCard,e))));break;case 1e3:"UltraPremium"==c?(e=a.super_premium,$("#priceFor1000").text(p(a.super_premium)),$("#discountPriceFor1000").text(p(discountAmt(flatDiscountPercentageCard,e)))):(e=a.premium,$("#priceFor1000").text(p(a.premium)),$("#discountPriceFor1000").text(p(discountAmt(flatDiscountPercentageCard,e))));break;default:$("#more-quantity").val()==a.qty&&("UltraPremium"==c?(e=a.super_premium,$("#priceForMore").text(p(a.super_premium)),$("#discountPriceForMore").text(p(discountAmt(flatDiscountPercentageCard,e)))):(e=a.premium,$("#priceForMore").text(p(a.premium)),$("#discountPriceForMore").text(p(discountAmt(flatDiscountPercentageCard,e)))))}a.qty==d&&($("#paperUltraPremium").text(p(a.super_premium-a.premium)),$("#paperUltraPremiumDiscounted").text(p(discountAmt(flatDiscountPercentageCard,a.super_premium-a.premium))),$("#paperPremium").text(""),$("#paperPremiumDiscounted").text(p(0,"Included")),$("#customCardPricing").text(p(a.back_side)),$("#customCardPricingDiscounted").text(p(discountAmt(flatDiscountPercentageCard,a.back_side))),$("#blankPricing").text(""),$("#blankPricingDiscounted").text(p(0,"Included")),$("#stdShippingPrice").text(""),$("#expShippingPrice").text(p(a.exp_shipping)),$("#stdShippingPriceDiscounted").text(p(discountAmt(flatDiscountPercentageCard,a.std_shipping),"Free!!")),$("#expShippingPriceDiscounted").text(p(discountAmt(flatDiscountPercentageCard,a.exp_shipping),"Free!!"))),0==f&&(f=!0,$("#priceForCardDesign").text(p(a.card_design)),$("#discountPriceForCardDesign").text(p(discountAmt(flatDiscountPercentageCard,a.card_design))))})}function p(a,b){var c=H.currency;return a=parseFloat(a),0==a?b||c+" 0.00":c+" "+Number(a).toFixed(2)}function q(){var a;a="hidden"==$("#svgedit_back").css("visibility")?window.editorFrame:window.editorFrameBack,a.addTextHard("Sample Text",function(a){$(".customTexts").append('<div class="form-group"><div class="col-md-12"><input id="'+a+'" type=text class="input form-control" placeholder="Sample Text" value=""/></div></div>'),$("#"+a).keyup(function(b){b.preventDefault(),w(a,this.value)})})}function r(a){$(".wizard-steps li").removeClass("active"),$(".wiz-two").addClass("active"),$(".panel-four").hide(),$(".panel-two").slideDown(),$("#accordionTwo").slideDown(),$("#accordionTwo").addClass("in"),$("html, body").animate({scrollTop:$(".panel-two").offset().top-125},1e3).promise().then(function(){a()})}function s(){L=!0,I.back_of_card=I.back_of_card||"Custom",$(".arrow-box_active").show(),$(".arrow-box").hide(),$(".arrow_box").addClass("active"),$("#svgedit").css("visibility","hidden"),$("#svgedit_back").css("visibility","visible"),window.editorFrameBack.setCardWebSite($("#cardWebSite").val()||"www.example.com"),window.editorFrameBack.setCardName($("#cardName").val()),window.editorFrameBack.setCardTitle($("#cardTitle").val()),window.editorFrameBack.setCardEmail($("#cardEmail").val()),window.editorFrameBack.setCardAL1($("#cardAL1").val()),window.editorFrameBack.setCardAL2($("#cardAL2").val()),u(window.editorFrameBack)}function t(a){L=!1,$(".arrow_box").removeClass("active"),$("#svgedit").css("visibility","visible"),$("#svgedit_back").css("visibility","hidden"),u(window.editorFrame)}function u(a){$(".customTexts").children().remove();var b=function(){for(var b=a.getCustomTexts(),c=0;c<b.length;c++)$(".customTexts").append('<div class="form-group"><div class="col-md-12"><input id="'+$(b[c]).attr("id")+'" type=text class="input form-control" value="'+$(b[c]).text()+'"/></div></div>'),$($(b[c]).attr("id")).keyup(function(a){a.preventDefault(),w($(b[c]).attr("id"),this.value)})};void 0!=a.getCustomTexts?b():$(a).load(function(){b()})}function v(){$("html, body").animate({scrollTop:$(".panel-two").offset().top-50},1e3),$(".create-card-main").css("min-height","1500px")}function w(a,b){var c;c="hidden"==$("#svgedit_back").css("visibility")?window.editorFrame:window.editorFrameBack,c.replaceText(a,b)}function x(b){pushState(b,"/design-business-card-online/"+b),a()}function y(a){$(".qty-next-span").unbind("click").click(function(b){b.stopPropagation(),x(a[0]+"/back-of-card")}),$(".finish-span").unbind("click").click(function(b){b.stopPropagation(),x(a[0]+"/save-card")}),$(".blank-next-span").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/finish")}),$(".finish-next-span").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/stock")}),$(".delivery-next-span").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/delivery")}),$(".stock-next-span").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/delivery")}),$(".stock-prev-span").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/finish")}),$(".finish-prev-span").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/back-of-card")}),$(".blank-prev-span").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/quantity")}),$(".delivery-prev-span").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/stock")}),$("#change-qty,.li-quantity").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/quantity")}),$("#change-finish,.li-finish").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/finish")}),$("#change-back-card,#change-card,.li-back-of-card").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/back-of-card")}),$("#change-shipping,.li-delivery").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/delivery")}),$("#change-stock,.li-stock").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/stock")}),$(".li-delivery").unbind("click").on("click",function(b){b.stopPropagation(),x(a[0]+"/delivery")}),I||(I={}),$("[name=optionsCount], #more-quantity").off().change(function(a){"More"==this.value?I.qty=$("#more-quantity").val():I.qty=this.value}),$("[name=optionsBackOfCard]").off().change(function(a){I.back_of_card=this.value}),$("[name=optionsFinish]").off().change(function(a){I.finish=this.value}),$("[name=optionsPaper]").off().change(function(a){I.paper_stock=this.value}),$("[name=optionsShipping]").off().change(function(a){I.shipping_type=this.value}),$("input[type=radio][name=optionsCount],[name=optionsFinish],[name=optionsPaper],[name=optionsBackOfCard],[name=optionsShipping],#backSidePremium").change(function(){n()}),$("#more-quantity").change(function(){$("#moreQtysRadio").prop("checked",!0),n()}),$("[name=optionsPurchaseCardDesign]").off().change(function(){I.purchase_design=$("[name=optionsPurchaseCardDesign]").is(":checked"),I.purchase_design?$("#noCardPrintOut").removeClass("hidden"):$("#noCardPrintOut").addClass("hidden"),$("[name=optionsDontWantPrintedCard]").prop("checked",!1),$("[name=optionsDontWantPrintedCard]").change(),
n()}),$("[name=optionsDontWantPrintedCard]").off().change(function(){I.dont_print_card=$("[name=optionsDontWantPrintedCard]").is(":checked"),I.dont_print_card?($(".qty-next-span").hide(),$(".li-back-of-card").hide(),$(".li-finish").hide(),$(".li-stock").hide(),$(".li-delivery").hide(),$(".only-printing").hide()):($(".qty-next-span").show(),$(".li-back-of-card").show(),$(".li-finish").show(),$(".li-stock").show(),$(".li-delivery").show(),$(".only-printing").show()),n()})}function z(a){var b=this.files,c=b[0];if(!c.type.match("application/pdf")&&!c.type.match("application/postscript")&&c.name.indexOf(".cdr")<0&&c.name.indexOf(".pdf")<0)bootbox.alert("The file format choosed is not supported.<br />Please select a PDF or CDR or EPS or AI file."),$(this).val(void 0);else{var d=new FileReader;d.addEventListener("load",function(b){var d=b.target,e=c.name.split(".");0==e.length?(c.type.match("application/pdf")&&(e="pdf"),c.type.match("application/postscript")&&(e="eps")):e=e.pop(),a(d.result,e)}),d.readAsDataURL(c)}}var A,B,C,D,E,F,G,H=[],I={},J={},K=!1,L=!1,M=!1,N={changeTextOfThis:function(a,b){"#cardWebSite"==a&&""==b&&(b="www.example.com",window.editorFrameBack.setCardWebSite(b)),$(a).val(b)},getSupportedFonts:getSupportedFonts,document:document,executeKeyUps:function(){$("#cardTitle").keyup(),$("#cardName").keyup(),$("#cardAL1").keyup(),$("#cardAL2").keyup(),$("#cardPhone").keyup(),$("#cardEmail").keyup(),$("#cardWebSite").keyup()}},O=!1;$(window).on("hashAdding",function(a){O=!0}),$(window).on("hashRemoving",function(a){O=!1}),b()});