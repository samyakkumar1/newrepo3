//Jquery Scripting
$(function () {
    function a(a, c, d) {
        a.fnCalls.push({fnName: c, args: d}),
        a.window && b(a)
    }
    function b(a) {
        $(a.selector)[0] && (a.window ? ($.each(a.fnCalls, function (b, c) {
            a.window[c.fnName].apply(this, c.args)
        }), a.fnCalls =[]) : setTimeout(function () {
            getIframeWindow($(a.selector)[0]).init && (a.window = getIframeWindow($(a.selector)[0]), a.window.init($, {$: $})),
            b(a)
        }, 1e3))
    }
    function c() {
        window.editorFrame.getAsJPGDataUrl(250, function (a) {
            d(D.front, frontImage, a, frontParams, frontBaseParams),
            $(".canvasBgBack").length > 0 && d(D.back, backImage, a, backParams, backBaseParams)
        })
    }
    function d(b, c, d, e, f) {
        var g = parseFloat(f[0]),
            h = parseFloat(f[1]),
            i = h / $(".canvasBgFront").height(),
            j = g / $(".canvasBgFront").width();
        parseFloat(e[0]) / i,
        parseFloat(e[1]) / j,
        parseFloat(e[2]),
        parseFloat(e[3]),
        parseFloat(e[4]),
        parseFloat(e[5]),
        parseFloat(e[6]),
        parseFloat(e[7]),
        parseFloat(e[8]);
        a(b, "initScalablePreview", [
            $,
            c,
            d,
            e,
            !0,
            350
        ])
    }
    function e(a) {
        $(".wiz-one").removeClass("active"),
        $(".wiz-two").removeClass("active"),
        $(".wiz-three").removeClass("active"),
        $(".wiz-four").removeClass("active"),
        $(".wiz-five").removeClass("active"),
        $(".panel-one").show(),
        "one" == a ? ($(".wiz-one").addClass("active"), $(".panel-five").hide(), $(".panel-two").hide(), $(".panel-three").hide(), $(".panel-four").hide()) : "five" == a ? ($(".wiz-five").addClass("active"), $(".panel-four").hide(), $(".panel-three").hide(), $(".panel-two").hide()) : ($(".panel-two").show(), "two" == a ? ($(".wiz-two").addClass("active"), $(".panel-three").hide(), $(".panel-four").hide()) : ($(".panel-three").show(), "three" == a ? ($(".wiz-three").addClass("active"), $(".panel-four").hide()) : "four" == a && ($(".wiz-four").addClass("active"), $(".panel-four").show())))
    }
    function f(a) {
        for (var b, c, d = $(".original-price:first").attr("data-currency"), e = $(".settingControl"), f = 0, h = 0, i = 0, j = 0, k = 0, l = 0; l < e.length; l++) {
            var m = $(e[l]),
                n = m.attr("data-related-setting"),
                o = m.attr("data-type"),
                p = m.val(),
                q = 0,
                r = 0,
                s = 0,
                t = 0,
                u = function (a) {
                    for (var d = $("[data-setting-id=" + n + "]"), e = 0; e < d.length; e++) {
                        var f = $(d[e]).attr("data-setting-value").split("-");
                        if (a <= parseInt(f[1]) && a >= parseInt(f[0])) {
                            c = parseFloat($(d[e]).attr("data-price")),
                            b = parseFloat($(d[e]).attr("data-real-price"));
                            break
                        }
                    }
                    c || (c = parseFloat($(d[d.length - 1]).attr("data-price")), b = parseFloat($(d[d.length - 1]).attr("data-real-price")))
                };
            switch (o) {
                case "quantity":
                    (!/^[0-9]+$/.test(p) || parseInt(p) < 1) && (a && bootbox.alert("Invalid quantity entered."), p = 1),
                    p = parseInt(p),
                    f = p,
                    $(".totalQty").text(f),
                    u(f);
                    break;
                case "quantityWithSize":
                    /^[0-9]+$/.test(p) || (a && bootbox.alert("Invalid quantity entered."), p = 1),
                    p = parseInt(p),
                    f += p,
                    $(".totalQty").text(f),
                    u(f);
                    break;
                case "radio": m.is(":checked") && ("0" == m.attr("data-independent") ? (r = parseFloat(m.attr("data-real-price")), q = parseFloat(m.attr("data-price"))) : (s = parseFloat(m.attr("data-real-price")), t = parseFloat(m.attr("data-price"))));
                    break;
                case "color": m.hasClass("active") && ("0" == m.attr("data-independent") ? (r = parseFloat(m.attr("data-real-price")), q = parseFloat(m.attr("data-price"))) : (s += parseFloat(m.attr("data-real-price")), t += parseFloat(m.attr("data-price"))));
                    break;
                case "checkbox": m.is(":checked") && ("0" == m.attr("data-independent") ? (r = parseFloat(m.attr("data-real-price")), q = parseFloat(m.attr("data-price"))) : (s = parseFloat(m.attr("data-real-price")), t = parseFloat(m.attr("data-price"))));
                    break;
                case "combo":
                    var v = m.find("option:selected");
                    "0" == m.attr("data-independent") ? (r = parseFloat(v.attr("data-real-price")), q = parseFloat(v.attr("data-price"))) : (s = parseFloat(v.attr("data-real-price")), t = parseFloat(v.attr("data-price")));
                    break;
                default:
                    //console.log(o)
            }
            r && q && (h += parseFloat(r), i += parseFloat(q)),
            s && t && (j += parseFloat(s), k += parseFloat(t))
        }
        for (var w = $(".price-label-real"), x = $(".price-label-reduced"), l = 0; l < w.length; l++) {
            var m = $(w[l]),
                r = h + parseFloat(m.attr("data-price"));
            m.text(g(d, r))
        }
        for (var l = 0; l < x.length; l++) {
            var m = $(x[l]),
                q = i + parseFloat(m.attr("data-price"));
            m.text(g(d, q))
        }
        var y = 0,
            z = 0;
        y = f * (h + b) + j,
        z = f * (i + c) + k,
        $("#totalOriginalPrice").text(g(d, y)),
        $("#totalReducedPrice").text(g(d, z))
    }
    function g(a, b, c) {
        return b = parseFloat(b),
        0 == b ? c || a + " 0.00" : a + " " + Number(b).toFixed(2)
    }
    function h(a) {
        return !isNaN(parseFloat(a)) && isFinite(a)
    }
    function i(a, b, c, d) {
        var e = $('<table class="table-responsive menuItm-table table table-bordered"></table>');
        b.append(e),
        e.append('<thead><tr><th>Quantity</th><th class="text-center">Price</th><th class="text-right">Save ' + flatDiscountPercentageOther + "%</th></tr></thead>");
        for (var f = 0; f < c.values.length; f++) {
            var i = c.values[f],
                j = i.price,
                k = discountAmt(flatDiscountPercentageOther, i.price),
                l = i.value_label.split("-");
            h(l[1]) && (x < l[1] || void 0 == x) && (x = parseFloat(l[1])),
            l = h(l[0]) ? l[0] : !1,
            e.append("<tr>                <td>" + i.value_label + "</td>                <td class='text-center original-price price-label-real' data-currency='" + i.currency + "' data-price='" + j + "' data-qty='" + l + "'>" + g(i.currency, j) + "</td>                <td class='text-right reduced-price price-label-reduced' data-qty='" + l + "' data-id='" + i.setting_value_id + "' id='pricing" + i.setting_value_id + "' data-currency='" + i.currency + "' data-real-price='" + j + "' data-price='" + k + "' data-setting-id='" + a + "' data-setting-value='" + i.value_label + "'>" + g(i.currency, k) + "</td>            </tr>")
        }
        $("[data-qty=false]").attr("data-qty", parseFloat(x) + 1)
    }
    function j(a, b, c, d, e, h) {
        var i = $("<table class='table'></table>");
        b.append(i);
        for (var j = 0; j < c.values.length; j++) {
            var k = c.values[j],
                l = k.price,
                m = discountAmt(flatDiscountPercentageOther, k.price);
            i.append("<tr><td class='col-md-4'><input data-independent='" + h + "' data-related-setting='" + e + "' data-price='" + m + "' data-real-price='" + l + "' class='settingControl' data-label='" + d + "' data-type='radio' type='radio' name='setting_" + a + "' data-setting-id='" + a + "' value='" + k.setting_value_id + "' data-value-label='" + k.value_label + "' /> " + k.value_label + "</td><td class='col-md-4 original-price' data-currency='" + k.currency + "' data-price='" + l + "' data-real-price='" + m + "'>" + g(k.currency, l) + "</td><td class='col-md-4 reduced-price ' data-id='" + k.setting_value_id + "' id='pricing" + k.setting_value_id + "' data-currency='" + k.currency + "' >" + g(k.currency, m) + "</td></tr>")
        }
        A || $("[name=setting_" + a + "]").first().prop("checked", !0),
        $("[name=setting_" + a + "]").change(function () {
            f()
        })
    }
    function k(a, b, c, d, e, h) {
        var i = $("<table class='table'></table>");
        b.append(i);
        for (var j = 0; j < c.values.length; j++) {
            var k = c.values[j],
                l = k.price,
                m = discountAmt(flatDiscountPercentageOther, k.price);
            i.append("<tr><td class='col-md-4'><input data-independent='" + h + "' data-related-setting='" + e + "' data-price='" + m + "' data-real-price='" + l + "' class='settingControl' data-type='checkbox' type='checkbox' name='setting_" + a + "' data-label='" + d + "' data-setting-id='" + a + "' value='" + k.setting_value_id + "' data-value-label='" + k.value_label + "'/> " + k.value_label + "</td><td class='col-md-4 original-price' data-currency='" + k.currency + "' data-price='" + l + "'>" + g(k.currency, l) + "</td><td class='col-md-4 reduced-price ' data-id='" + k.setting_value_id + "' id='pricing" + k.setting_value_id + "' data-currency='" + k.currency + "' data-price='" + m + "'>" + g(k.currency, m) + "</td></tr>")
        }
        A || $("[name=setting_" + a + "]").first().prop("checked", !0),
        $("[name=setting_" + a + "]").change(function () {
            f()
        })
    }
    function l(a, b, c, d, e, g) {
        var h = $('<div class="menuItm-options"><label>' + d + " :</label></div>"),
            i = $('<span class="menuItm-options-span menuItm-clors"></span>');
        h.append(i),
        b.append(h);
        for (var j = 0; j < c.values.length; j++) {
            var k = c.values[j],
                l = k.price || 0,
                m = discountAmt(flatDiscountPercentageOther, k.price);
            i.append("<span data-toggle='tooltip' data-setting-value='" + k.setting_value_id + "'  data-placement='top' title='" + k.value_label + "' style='background-color:" + k.value_label + "' type='color' data-independent='" + g + "' data-related-setting='" + e + "' data-real-price='" + l + "' data-price='" + m + "' class='settingControl color-preview' data-label='" + d + "' data-type='color' data-setting-id='" + a + "' value='" + k.value_label + "' name='setting_" + a + "' data-value-label='" + k.value_label + "'></span>")
        }
        $('[data-toggle="tooltip"]').tooltip(),
        $("[name=setting_" + a + "]").click(function (b) {
            $("[name=setting_" + a + "]").removeClass("active"),
            $(this).addClass("active"),
            f(),
            b.stopPropagation()
        }),
        A || $("[name=setting_" + a + "]").first().click()
    }
    function m(a, b, c, d, e, h) {
        var i = $('<div class="menuItm-options"><label>' + d + ' :</label><span class="menuItm-options-span"></span></div>'),
            j = $("<select class='selectpicker settingControl' data-independent='" + h + "' data-related-setting='" + e + "' data-setting-id='" + a + "' data-label='" + d + "' data-type='combo' name='setting_" + a + "'></select>");
        i.find(".menuItm-options-span").append(j),
        b.append(i);
        for (var k = 0; k < c.values.length; k++) {
            var l = c.values[k],
                m = l.price,
                n = discountAmt(flatDiscountPercentageOther, l.price);
            j.append("<option data-price='" + n + "' data-real-price='" + m + "' value='" + l.setting_value_id + "'>" + l.value_label + (h ? " (" + g(l.currency, m) + " Extra)" : "") + "</option>")
        }
        $("[name=setting_" + a + "]").change(function () {
            f()
        })
    }
    function n(a, b, c, d, e) {
        b.append("<input data-independent='" + e + "' data-related-setting='" + d + "' name='setting_" + a + "' type='text' data-label='" + c + "' data-setting-id='" + a + "' data-type='text' class='settingControl form-control'/>"),
        $("[name=setting_" + a + "]").keyup(function () {
            f()
        }),
        $("[name=setting_" + a + "]").change(function () {
            f(!0)
        })
    }
    function o(a, b, c, d, e) {
        b.append("<div class='menuItm-options'><label>" + c + " :</label><span class='menuItm-options-span'><input data-independent='" + e + "' value='1' data-related-setting='" + d + "' name='setting_" + a + "' type='text' data-label='" + c + "' data-setting-id='" + a + "' data-type='quantity' class='settingControl form-control'/></span></div>"),
        $("[name=setting_" + a + "]").keyup(function () {
            f()
        }),
        $("[name=setting_" + a + "]").change(function () {
            f(!0)
        })
    }
    function p(a, b, c, d, e, g) {
        for (var h = $("<div class='col-md-2 menuItm-options menuItemNoBorderOrMargin'><label>" + d + " :</label></div>"), i = "<div class='col-md-10'><table><tr>", j = 0; j < c.values.length; j++) 
            i += "<td>" + c.values[j].value_label + "</td>";
        
        i += "</tr><tr>";
        for (var j = 0; j < c.values.length; j++) 
            i += "<td><input data-setting-value='" + c.values[j].setting_value_id + "' data-independent='" + g + "' value='" + (
            0 == j ? "1" : "0"
        ) + "' data-related-setting='" + e + "' name='setting_" + a + "' type='text' data-label='" + d + "' data-setting-id='" + a + "' data-type='quantityWithSize' class='settingControl form-control'/></td>";
        
        i += "</tr></table></div><div class='col-md-12'>&nbsp;</div>",
        b.append(h),
        b.append(i),
        $("[name=setting_" + a + "]").keyup(function () {
            f()
        }),
        $("[name=setting_" + a + "]").change(function () {
            f(!0)
        })
    }
    function q(a, b, c, d, e, f, g) {
        switch (b) {
            case "Pricing Label": i(a, c, d, e, f, g);
                break;
            case "Radio": j(a, c, d, e, f, g);
                break;
            case "Checkbox": k(a, c, d, e, f, g);
                break;
            case "Text": n(a, c, e, f, g);
                break;
            case "Quantity": o(a, c, e, f, g);
                break;
            case "Combo": m(a, c, d, e, f, g);
                break;
            case "Color": l(a, c, d, e, f, g);
                break;
            case "QuantityWithSize": p(a, c, d, e, f, g)
        }
    }
    function r(a) {
        doGet("/getOtherProductSettings", {
            product_id: otherProductId
        }, function (b) {
            if (200 == b.status) {
                for (var c =
                    {}, d = 0; d < b.settings.length; d++) 
                    c[b.settings[d].page_number] || (c[b.settings[d].page_number] =
                        { items: [],
                        label: ""
                    }),
                    c[b.settings[d].page_number].items.push(b.settings[d]),
                    "Side Label" != b.settings[d].control_type && (c[b.settings[d].page_number].label = b.settings[d].setting_name);
                
                $("#settingsSteps").children().remove(),
                $("#settingsContent").children().remove();
                var e = 0,
                    g = 0,
                    h = function () {
                        g++,
                        g == b.settings.length && (f(), $(".tooltip1").tooltip(), $('a[data-toggle="tab"]').on("show.bs.tab", function (a) {
                            var b = $(a.target);
                            return b.parent().hasClass("active") ? !1 : void 0
                        }), a ? a() : $.noop())
                    };
                for (var i in c) 
                    if (c.hasOwnProperty(i)) {
                        I.push(i),
                        $("#settingsSteps").append("<a class='col-md-12 link pageLink' data-idx='" + e + "' data-page='" + i + "'>" + i + ". " + c[i].label + "</a>"),
                        $("#settingsContent").append("<div class='settingPages' id='page" + i + "'></div>");
                        for (var j = $("#page" + i), d = 0; d < c[i].items.length; d++) {
                            var k = c[i].items[d],
                                l = $("<span></span>"),
                                m = [
                                    "Color",
                                    "Combo",
                                    "Radio",
                                    "Checkbox",
                                    "Pricing Label",
                                    "QuantityWithSize"
                                ];
                            j.append(l),
                            m.indexOf(k.control_type) > -1 ? doGetWithExtraParams("/getOtherProductSettingsValues", {
                                setting_id: k.id,
                                country_id: $(".top-countries-list").val()
                            }, {
                                independent_pricing: k.independent_pricing,
                                relatedSetting: k.related_setting,
                                controlType: k.control_type,
                                elem: l,
                                setting_id: k.id,
                                settingName: k.setting_name
                            }, function (a, b) {
                                200 == a.status ? (q(b.setting_id, b.controlType, b.elem, a, b.settingName, b.relatedSetting, b.independent_pricing), h()) : (showToast("Error: " + a.msg))
                            }, function (a) {
                                //console.log(a),
                                showToast("Error: Communication failure!!!")
                            }) : (q(k.id, k.control_type, l, void 0, k.setting_name, k.related_setting, k.independent_pricing), h())
                        }
                        j.hide(),
                        e ++
                    }
                
                $(".pageLink").off().click(function () {
                    $(".settingPages").hide(),
                    H = $(this).attr("data-page"),
                    $("#page" + $(this).attr("data-page")).show(),
                    $(".pageLink").removeClass("text-primary"),
                    $(this).addClass("text-primary");
                    var a = $(".panel-three .panel-body").offset().top;
                    $("body").scrollTop(a - $(".panel-group").offset().top + $(".panel-group").scrollTop()),
                    $(this).attr("data-idx") == e - 1 ? ($(".wiz-four").addClass("active"), $(".wiz-three").removeClass("active"), $("#btnNextStep3").text("Checkout"), $("#addToCartBtn").text("Checkout"), e > 1 ? $("#btnBackStepSettings").show() : $("#btnBackStepSettings").hide()) : (0 == $(this).attr("data-idx") ? $("#btnBackStepSettings").hide() : e > 1 ? $("#btnBackStepSettings").show() : $("#btnBackStepSettings").hide(), $(".wiz-three").addClass("active"), $(".wiz-four").removeClass("active"), $("#btnNextStep3").text("Next"), $("#addToCartBtn").text("Next"))
                }),
                $(".pageLink:first").trigger("click")
            } else 
                showToast("Error: " + b.msg)
            
        }, function (a) {
            showToast("Error: Communication failure!!!")
        })
    }
    function s() {
        window.editorFrame.saveAction ? window.editorFrame.saveAction(!0, function (a) {
            $("#productPreview").attr("src", a)
        }) : setTimeout(function () {
            s()
        }, 2048)
    }
    function t() {
        var a = function (a, b) {
                if (G) 
                    a[2] || e("one"),
                    b ? b() : $("body").scrollTop(0);
                 else {
                    var c = function (a) {
                        if (a) {
                            var b = getUser();
                            if ("Purchased" != a.status || "Purchased" == a.status && a.owner == b.id) {
                                var c = "";
                                c = "string" == typeof a.id && 0 == a.id.indexOf("logo_") ? "data:image/svg+xml;base64logo_resp.id," + Base64.encode(a.url) : "/getUserLogoImage?id=" + a.s3_logo_url + "&random=" + Math.random();
                                var d = '<li class="col-md-3" data-url="' + c + '" id="userLogo' + a.id + '"><object type="image/svg+xml" data="' + c + '"></object></li>';
                                $(".logos-list").append(d),
                                $("#userLogo" + a.id).click(function (b) {
                                    z = void 0,
                                    v(a.id + "/choose-design")
                                })
                            }
                        } else {
                            var d = $('<li class="col-md-3"><span class="custom-logo"><img src="/img/upload_arrow.png"><br />Upload your Design</span></li>');
                            $(".logos-list").append(d),
                            d.click(function () {
                                $("#customLogoUpload").click()
                            })
                        }
                    };
                    G = !0,
                    $("body,html").animate({
                        scrollTop: 0
                    }, 1e3).promise().then(function () {
                        e("one");
                        var a = '<a id="uploadCustomLogo"><li class="col-md-12" style="height:140px;"><span style="padding-top:10%;font-size:20px;"><img src="/img/upload_arrow.png"><br />Upload your Design</span></li></a>';
                        if (1 == isLoggedIn()) 
                            doPost("/listUserLogos", {}, function (d) {
                                if (200 == d.status) 
                                    if (0 == d.logos.length) 
                                        $(".logos-list").html(a),
                                        b ? b() : $.noop();
                                    
                                 else {
                                    c();
                                    for (var e = 0; e < d.logos.length; e++) 
                                        c(d.logos[e]);
                                    
                                    b ? b() : $.noop()
                                } else 
                                    $(".logos-list").html(a),
                                    b ? b() : $.noop();
                                
                                $("#uploadCustomLogo").click(function () {
                                    $("#customLogoUpload").click()
                                })
                            }, function (a) {
                                bootbox.alert("Communication Error!!")
                            });
                         else {
                            var d = retrieveJson("logos");
                            d && d.length > 0 ? (c(), d.forEach(function (a, b) {
                                var d = retrieveJson(a);
                                d.id = a,
                                d.s3_logo_url = a,
                                c(d)
                            }), b ? b() : $.noop()) : ($(".logos-list").html(a), b ? b() : $.noop()),
                            $("#uploadCustomLogo").click(function () {
                                $("#customLogoUpload").click()
                            })
                        }
                    })
                }
            },
            b = function (a, b) {
                d(a, function () {
                    var d = function () {
                        $("#svgEditorFrame").empty(),
                        $("#svgEditorFrame").append('<iframe src="/svgedit/other_editor_frame.html" name="editorFrame" style="margin: 0px; width: 100%; height: 100%; border: none; min-height: 500px" id="svgedit"></iframe>'),
                        $(window.editorFrame).on("load", function () {
                            var b = function (d) {
                                setTimeout(function () {
                                    window.editorFrame.setParent ? (window.editorFrame.setParent({
                                        document: document,
                                        repaint: function () {
                                            doGet("/getOtherProductDetails?id=" + otherProductId, {}, function (a) {
                                                200 == a.status ? (frontParams = a.details.front_logo_params.split(";"), backParams = a.details.back_logo_params.split(";"), frontBaseParams = a.details.base_params_front.split(";"), backBaseParams = a.details.base_params_back.split(";"), c()) : (bootbox.alert("Error: " + a.msg))
                                            }, function (a) {
                                                //console.log(a),
                                                bootbox.alert("Communication Error!!")
                                            })
                                        },
                                        handleSvgChange: function () {
                                            c(),
                                            s(),
                                            $("#previewBtnLink").click()
                                        },
                                        executeKeyUps: $.noop,
                                        getSupportedFonts: getSupportedFonts,
                                        frontParams: frontParams,
                                        frontBaseParams: frontBaseParams,
                                        frontImage: frontImage,
                                        getDesignSize: function (a) {
                                            var b = $($(".designs-list").children()[1]).attr("data-url");
                                            if (b) {
                                                var c = new Image;
                                                c.src = b,
                                                c.onload = function () {
                                                    a(c.height, c.width)
                                                }
                                            } else 
                                                a(void 0)
                                            
                                        }
                                    }), window.editorFrame.initCommon("OP"), z ? window.editorFrame.loadImage("/getUserOtherProductImage?id=" + z + "&random=" + Math.random(), void 0, void 0, !0) : window.editorFrame.loadOtherProductImage("custom" == a[2] ? y : $("#userLogo" + a[2]).attr("data-url"), "default" == a[3] ? void 0 : $("#userDesign" + a[3]).attr("data-url")), w = a[2] + ":" + a[3]) : b(d + 100)
                                }, d)
                            };
                            b(0)
                        }),
                        e("two"),
                        b ? b() : $.noop()
                    };
                    if ($(".panel-two").is(":visible")) {
                        a[4] || e("two");
                        var f = $(".panel-two .panel-body").offset().top + 70;
                        w != a[2] + ":" + a[3] ? (d(), $("body").scrollTop(f - $(".panel-group").offset().top + $(".panel-group").scrollTop())) : b ? b() : $("body").scrollTop(f - $(".panel-group").offset().top + $(".panel-group").scrollTop())
                    } else {
                        $(".panel-two").show();
                        var f = $(".panel-two .panel-body").offset().top + 70;
                        $("body,html").animate({
                            scrollTop: f - $(".panel-group").offset().top + $(".panel-group").scrollTop()
                        }, 1e3).promise().then(function () {
                            d()
                        })
                    }
                })
            },
            d = function (b, c) {
                a(b, function () {
                    if (1 == F) 
                        if ("choose-design" == b[3] && e("five"), 0 == $(".designs-list").children().size() && "default" != b[3] && v(b[2] + "/default"), c) 
                            c();
                        
                     else {
                        var a;
                        a = $(".panel-five .panel-body").is(":visible") ? $(".panel-five .panel-body").offset().top : $(".panel-two .panel-body").offset().top,
                        $("body").scrollTop(a - $(".panel-group").offset().top + $(".panel-group").scrollTop())
                    } else {
                        var d = function (a) {
                            var b,
                                c = a.design_file ? "/getOtherProductDesignImage?url=" + a.design_file : "/img/no-design.png";
                            void 0 == a.design_file ? (b = '<li data-id="' + a.id + '" data-url="' + c + '"><img class="designPreviews" src="' + c + '" id="userDesign' + a.id + '"/></li>', $(".designs-list").append(b)) : (b = '<li data-id="' + a.id + '" data-url="' + c + '"><iframe data-url="' + c + '" class="designPreviews" src="/product-preview/big-preview.html" id="userDesign' + a.id + '"> </iframe></li>', $(".designs-list").append(b), $("#userDesign" + a.id).on("load", function () {
                                var a = this.contentWindow;
                                a.initScalablePreview($, frontImage, c, frontParams, !0, 180, window)
                            })),
                            $("#userDesign" + a.id).parent().click(function (a) {
                                a.stopPropagation();
                                var b = history.state.name.toString().split("/");
                                v(b[2] + "/" + $(this).attr("data-id")),
                                a.stopPropagation()
                            })
                        };
                        $(".panel-five").show();
                        var a;
                        a = $(".panel-five .panel-body").is(":visible") ? $(".panel-five .panel-body").offset().top : $(".panel-two .panel-body").offset().top,
                        $(".designs-list").children().remove(),
                        d({design_file: void 0, id: "default"}),
                        $("body,html").animate({
                            scrollTop: a - $(".panel-group").offset().top + $(".panel-group").scrollTop()
                        }, 1e3).promise().then(function () {
                            doGet("/getOtherProductDesigns", {
                                id: otherProductId
                            }, function (a) {
                                if (F =! 0, a.designs.length > 0) 
                                    for (var f = 0; f < a.designs.length; f++) 
                                        d(a.designs[f]);
                                    
                                 else 
                                    "choose-design" == b[3] ? v(b[2] + "/default") : "default" == b[3];
                                
                                "choose-design" == b[3] && e("five"),
                                c ? c() : $.noop()
                            }, function (a) {
                                //console.log(a),
                                showToast(a.msg)
                            })
                        })
                    }
                })
            },
            g = function (a) {
                b(a, function () {
                    s();
                    var b = function () {
                        "save" == a[4] ? $(".wiz-four").addClass("active") : $(".wiz-three").addClass("active"),
                        r(function () {
                            if ("purchase" == C && $(".settingControl").attr("disabled", !0), $("#previewBtnLink").click(), "undefined" != typeof A) 
                                for (var a = 0; a < B.length; a++) 
                                    switch (B[a].control_type) {
                                        case "Color":
                                            $("[name=setting_" + B[a].product_settings_id + "][data-setting-value=" + B[a].setting_value + "]").addClass("active");
                                        case "Radio":
                                            $("input[name=setting_" + B[a].product_settings_id + "][value=" + B[a].setting_value + "]").prop("checked", !0);
                                            break;
                                        case "Checkbox":
                                            $("input[name=setting_" + B[a].product_settings_id + "][value=" + B[a].setting_value + "]").prop("checked", !0);
                                            break;
                                        case "Pricing Label":
                                            break;
                                        case "QuantityWithSize":
                                            var b = B[a].setting_value.split("=");
                                            $("[data-setting-value=" + b[0] + "]").val(b[1]);
                                            break;
                                        default:
                                            $("[name=setting_" + B[a].product_settings_id + "]").val(B[a].setting_value)
                                    }
                                
                            
                            f()
                        })
                    };
                    if ($(".panel-three").is(":visible")) {
                        var c = $(".panel-three .panel-body").offset().top;
                        $("body,html").scrollTop(c - $(".panel-group").offset().top + $(".panel-group").scrollTop()),
                        b()
                    } else {
                        e("six");
                        var c = $(".panel-three .panel-body").offset().top;
                        $("body,html").animate({
                            scrollTop: c - $(".panel-group").offset().top + $(".panel-group").scrollTop()
                        }, 1e3).promise().then(function () {
                            b()
                        })
                    }
                })
            };
        if (!location.hash && E && (E =! 1), !E) 
            if (null == history.state) {
                var h = window.location.pathname.split("/").splice(1).join("/");
                pushState(h, location.pathname.split("/")[0] + "/" + h),
                t()
            }
         else {
            var i = history.state.name.toString().split("/");
        
        "edit" == i[2] ? (C = i[4], doGet("/getUserOtherProductDetails", {
            id: i[3],
            from: C
        }, function (a) {
            200 == a.status ? (A = a.product.id, z = a.product.image_url, w = a.product.base_design_id, B = a.settings, v(null == w ? (a.product.user_logo_id ? a.product.user_logo_id : "custom") + "/default" : (a.product.user_logo_id ? a.product.user_logo_id : "custom") + "/" + w)) : (showToast("Error: " + a.msg), console.log(a))
        }, function (a) {
            showToast("Communication failure!!!")
            //console.log(a)
        })) : i[4] ? g(i) : i[3] ? "choose-design" == i[3] ? d(i) : b("default" == i[3] ? i : i) : i[2] ? v(i[2] + "/choose-design") : a(i)
    }
}
function u() {
    doGet("/getOtherProductDetails?id=" + otherProductId, {}, function (a) {
        200 == a.status ? (frontParams = a.details.front_logo_params.split(";"), backParams = a.details.back_logo_params.split(";"), frontBaseParams = a.details.base_params_front.split(";"), backBaseParams = a.details.base_params_back.split(";")) : (console.log(a), bootbox.alert("Error: " + a.msg))
    }, function (a) {
        //console.log(a),
        bootbox.alert("Communication Error!!")
    }),
    $("#customLogoUpload").on("change", function (a) {
        if (window.File && window.FileReader && window.FileList && window.Blob) {
            var b = a.target.files[0],
                c = new FileReader;
            console.log("B :",b);
            b && (addWaitingOverlay(), c.readAsDataURL(b)),
            c.addEventListener("load", function () {
                removeWaitingOverlay(),
                y = c.result,
                z = void 0,
                v("custom/choose-design"),
                setTimeout(function(){
                    svgdesign = document.getElementById('svgedit');
                    svgdesign.contentWindow.checkTransparency();
                },11000),
                console.log("Y :",y);
            }, !1)
        } else 
            alert("The File APIs are not fully supported in this browser.")
        
    }),
    $("#btnBackStep2").click(function () {
        var a = window.location.pathname.split("/");
        v(0 == $(".designs-list").children().size() ? "" : a[a.length - 2] + "/choose-design")
    }),
    $("#btnBackStep5").click(function () {
        v("")
    }),
    $("#buynow").click(function () {
        var a = window.location.pathname.split("/").splice(3, 2);
        v(a.join("/") + "/settings")
    }),
    $("#sell-online").click(function () {
        document.getElementById('svgedit').contentWindow.getTransparency(function(istransparent){
            if(istransparent == true){
                $('.panel-four').show();
            }else{
                bootbox.alert("Design quality is not good please re-upload the design")
            }
        })
    }),
    $("#btnSaveStep2").click(function () {
        $('#panel-choice').show();
    }),
    $("#addToCartBtn").click(function (a) {
        a.preventDefault,
        $("#btnNextStep3").trigger("click")
    }),
    $("#btnBackStepSettings").click(function (a) {
        a.preventDefault,
        $("#btnBackStep3").trigger("click")
    }),
    $("#editBtnLink").click(function () {
        $("#btnBackStep3").trigger("click")
    }),
    $("body").mousedown(function () {
        $("#zoomPreviewDiv").hide()
    }),
    $("#previewBtnLink").click(function () {
        window.editorFrame.getAsJPGDataUrl(1500, function (a) {
            $("#canvasBgPreview").remove(),
            $("#bottomIframeContainer").append('<iframe class="small" src="/product-preview/big-preview.html" id="canvasBgPreview" style="min-height:275px;"></iframe>'),
            $("#canvasBgPreview").on("load", function () {
                var b = $("#canvasBgPreview")[0].contentWindow;
                window.addEventListener("message", function (a) {
                    $("#canvasBgPreview").height(a.data.height),
                    $("#canvasBgPreview").width(a.data.width)
                }, !1),
                b.initScalablePreview($, frontImage, a, frontParams, !1, void 0, window)
            })
        })
    }),
    $("#btnNextStep3").click(function () {
        if (H ++, $("[data-page=" + H + "]").length > 0) 
            $("[data-page=" + H + "]").click();
         else {
            H --;
            var a = $(".settingControl"),
                b = {},
                c = !1;
            if ("purchase" != C) 
                for (var d = 0; d < a.length; d++) {
                    var e = $(a[d]),
                        f = e.attr("data-setting-id"),
                        g = e.attr("type") ? e.attr("type").toLowerCase() : "",
                        h = e.attr("data-type");
                    if (void 0 == b[f] || "checkbox" == g || "quantityWithSize" == h) {
                        var i,
                            j;
                        if ("radio" == g) 
                            i = $("[name=" + e.attr("name")).filter(":checked").val(),
                            j = $("[name=" + e.attr("name")).filter(":checked").attr("data-value-label");
                         else if ("color" == g) {
                            if (! e.hasClass("active")) 
                                continue;
                            
                            i = e.attr("data-setting-value"),
                            j = $("[name=" + e.attr("name") + "].active").attr("data-value-label")
                        } else if ("checkbox" == g) {
                            if (! e.is(":checked")) 
                                continue;
                            
                            i = b[f] ? b[f].value : [],
                            i.push(e.val()),
                            j = b[f] ? b[f].text : [],
                            j.push(e.filter(":checked").attr("data-value-label"))
                        } else 
                            "quantityWithSize" == h ? (i = b[f] ? b[f].value : [], i.push(e.attr("data-setting-value") + "=" + e.val()), j = b[f] ? b[f].text : [], j.push(e.attr("data-value-label"))) : (i = e.val(), j = e.children().filter("option:selected").text(), "quantity" == h && (/^[0-9]+$/.test(i) || (i =! 1)));
                        
                        if (! i) {
                            bootbox.alert("Value is not properly filled for the field '" + e.attr("data-label") + "'"),
                            c = !0;
                            break
                        }
                        b[f] = {
                            value: i,
                            text: j,
                            type: g
                        }
                    }
                }
            
             if (! c) {
                var k = w.split(":"),
                    l = {
                        settings: b,
                        product_id: otherProductId,
                        design_id: "default" == k[1] ? null : k[1],
                        saved_item_id: A,
                        user_logo_id: "custom" == k[0] || "null" == k[0] ? null : k[0],
                        svg_data: window.editorFrame.getSvgString(),
                        saved_to: C,
                        url: z
                    },
                    m = A ? "/updateUserOtherProduct" : "/addUserOtherProduct";
                doPost(m, l, function (a) {
                    if (200 == a.status) {
                        var b = function () {
                            "purchase" != C ? window.location = "/checkout" : showToast("Modifications to the purchased item is finished.", "success")
                        };
                        addOtherProductToShoppingCart(a.insertId || A, function () {
                            b()
                        })
                    } else 
                        //console.log(a),
                        showToast("Error: " + a.msg)
                    
                }, function (a) {
                    //console.log(a),
                    showToast("Communication failure!!")
                })
            }
        }
   } ),
    $("#btnBackStep3").click(function () {
        if (H > 1) 
            H --,
            $("[data-page=" + H + "]").click();
         else {
            var a = window.location.pathname.split("/").splice(3, 3);
            a.pop(),
            v(a.join("/"))
        }
    }),
    t(),
    addPopState(t)
}
function v(a) {
    var b = "other/" + location.pathname.split("/")[2] + "/" + a;
    pushState(b, "/" + b),
    t()
}



var w, x, y, z, A, B, C, D = {
        front: {
            fnCalls: [],
            window: void 0,
            selector: "#canvasBgFront"
        },
        back: {
            fnCalls: [],
            window: void 0,
            selector: "#canvasBgBack"
        }
    }, E = !1, F = !1, G = !1, H = 1, I = [];
$(window).on("hashAdding", function (a) {
    E = !0
}), $(window).on("hashRemoving", function (a) {
    E = !1
}), $("#canvasBgFront").ready(function () {
    b(D.front)
}), $("#canvasBgBack").ready(function () {
    b(D.back)
}), u()});
