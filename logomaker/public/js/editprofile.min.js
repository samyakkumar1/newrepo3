$(function(){function a(){isLoggedIn()?(addWaitingOverlay(),$("#editProfileForm").validate(),$("#changePassword").click(function(a){a.preventDefault(),$("#changePwdDiv").toggle("fast")}),$("#saveProfile").click(function(a){a.preventDefault(),$("#editProfileForm").valid()?c():bootbox.alert("Please fill the required fields correctly.")}),b(),removeWaitingOverlay()):window.location="/?redir=editProfile"}function b(){$("#emailId").val(getUser().email),$("#phone_num").val(getUser().phone_num),$("#first_name").val(getUser().first_name),$("#last_name").val(getUser().last_name),$("#address1").val(null==getUser().address?"":getUser().address.split("\n")[0]),$("#address2").val(null==getUser().address?"":getUser().address.split("\n")[1]),$("#city").val(getUser().city),$("#state").val(getUser().state),$("#postal_code").val(getUser().postal_code),$("#country").val(getUser().country)}function c(){var user = getUser();var a={usertype: user.usertype,emailId:$("#emailId").val(),phone_num:$("#phone_num").val(),first_name:$("#first_name").val(),last_name:$("#last_name").val(),address:$("#address1").val()+"\n"+$("#address2").val(),country:$("#country").val(),city:$("#city").val(),state:$("#state").val(),postal_code:$("#postal_code").val(),current_password:$("#current_password").val()};getSalt(a.emailId,function(b){a.old_md5_password=MD5(b+":"+a.current_password),delete a.current_password,doPost("/updateUser",a,function(a){200==a.status?(setUser(a.user),bootbox.alert("Profile successfully updated."),window.location="/"):(console.log(a),bootbox.alert("Password entered is invalid."))},function(a){console.log(a),bootbox.alert("string"==typeof a?a:"Server Error: "+a.error)})},function(a){console.log(a),bootbox.alert("string"==typeof a?a:"Server Error: "+a.error)})}a()});